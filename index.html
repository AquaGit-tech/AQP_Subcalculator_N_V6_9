<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AQP Subcalculator - Onderaannemer prijsberekening voor Vecon">
    <meta name="author" content="Vecon">
    <meta name="robots" content="noindex, nofollow">
    <title>AQP Subcalculator V10.0</title>
    <style>
    /* ============================================================
       AQP SUBCALCULATOR V10.0
       ============================================================
       BUILD DATE: 05-12-2025
       STATUS: PRODUCTION READY
       
       CHANGELOG V10.0:
       ---------------
       [UTF-8 ENCODING CONVERSIE]
       - EUR → € (alle user-facing weergaves)
       - m2 → m² (placeholders, units, price-badges, modals)
       - (c) → © (footer copyright)
       - Technische identifiers ongewijzigd
       
       CHANGELOG V9.29:
       ---------------
       [SOPRO - GLASVEZELWAPENING VERWIJDERD]
       - Wapening checkbox volledig verwijderd uit Sopro component
       - Sopro is nu alleen mortel (conform KB: wapening is optioneel)
       - Formule: 1,2 kg/m2 per mm droge laagdikte x € 3,125/kg (EUR 75/24kg)
       - Prijzen: 2 lagen EUR 7,50, 3 lagen EUR 11,25, 4 lagen EUR 15,00
       
       [FIX & FINISH - CORRECTIES]
       - Naam: "ABS Finish" -> "Fix & Finish"
       - Verbruik: 1,8 kg/m2 -> 4 kg/m2
       - Prijs: EUR 2,61 -> EUR 2,40/m2 (4 kg x € 0,60/kg)
       
       CHANGELOG V9.28:
       ---------------
       [BIJKOMEND PLEISTERWERK - PUUR MP75]
       - Herwerkt naar puur MP75 basis (zonder Snelband)
       - Materiaal: MP75 EUR 2,85/cm/m² (7,5 kg/cm x € 0,38/kg)
       - Arbeid: EUR 7,15/cm/m² (vast)
       - Totaal: EUR 10,00/cm/m² (ongewijzigd)
       - Info modal met checkbox voor MP75 materiaal
       - Uitvinken MP75 = alleen arbeidskosten (EUR 7,15/cm/m²)
       
       [BUGFIX - TIJD DUBBELTELLING TOTAALOVERZICHT]
       - Herberekening van result.manuren en result.loon aan einde van
         berekenDynamisch als som van alle component waarden
       - Voorkomt inconsistentie tussen componentkaart (correct) en
         totaaloverzicht (was dubbel)
       
       CHANGELOG V9.27:
       ---------------
       [XPS VEREENVOUDIGD]
       - PU-schuim verwijderd uit XPS berekening en modal
       - Vier checkboxes: plaat, L-gips, Gitex, Snelband
       - Materiaalprijs per dikte (zonder PU-schuim):
         * 20mm: EUR 9,16 -> EUR 8,32
         * 30mm: EUR 9,84 -> EUR 9,00
         * 40mm: EUR 11,26 -> EUR 10,42
         * 50mm: EUR 12,57 -> EUR 11,73
         * 60mm: EUR 13,89 -> EUR 13,05
       
       CHANGELOG V9.26:
       ---------------
       [MEMBRAAN CORRECTIE - HYGROSCOPISCHE KB]
       - Twee checkboxes: CODEX POWER CX2 + SNC-Membraan
       - CODEX POWER CX2: 6,25 kg/m² x € 0,60/kg = € 3,77/m2
       - SNC-Membraan: 1,10 m²/m² x € 4,03/m2 = € 4,43/m2
       - Materiaalprijs: EUR 8,00/m2 -> EUR 8,20/m2 (KB conform)
       - Bron: HYGROSCOPISCHE_BEHANDELING_MET_SNC-MEMBRAAN_KB
       
       CHANGELOG V9.25:
       ---------------
       [CHECKBOX SYNC - COMPONENTKAART = MODAL]
       - BUG FIX: Componentkaart toonde COMP.mat i.p.v. checkbox-gebaseerde prijs
       - berekenDynamisch() gebruikt nu effectieve prijs functies:
         * Injecties: getInjectiesMatPrijs()
         * Membraan: getMembraanMatPrijs()
         * Bezetten: getBezettenMatPrijs()
         * XPS: getXpsMatPrijs(dikte)
         * Sopro: getSoproMatPrijs(lagen)
         * Asocret: getAsocretMatPrijs(metAutex)
         * Fixfinish: getFixfinishMatPrijs()
         * Fassashield: getFassashieldMatPrijs()
       - berekenVasteTarieven() ook aangepast voor checkbox sync
       - Resultaat: uitvinken checkbox = € 0,00 in BEIDE weergaves
       
       CHANGELOG V9.24:
       ---------------
       [INJECTIES VEREENVOUDIGD]
       - PU-schuim verwijderd uit berekening en modal
       - Materiaalprijs: EUR 3,30/m -> EUR 3,16/m (alleen Fassa Inject)
       - Eén checkbox: Fassa Inject (EUR 3,16/m)
       
       CHANGELOG V9.23:
       ---------------
       [INJECTIES CORRECTIE - FASSA INJECT KB]
       - Kiesol MB -> Fassa Inject (correcte productnaam)
       - Materiaalprijs: EUR 2,00/m -> EUR 3,30/m (KB conform)
       - Twee checkboxes: Fassa Inject (EUR 3,16/m) + PU-schuim (EUR 0,14/m)
       - Verbruik: 0,2 L/m x € 15,80/L = € 3,16/m
       - PU-schuim: forfait EUR 0,14/m
       - Bron: FASSA_INJECT_VOCHTINJECTIES_KNOWLEDGE_BASE
       
       CHANGELOG V9.22:
       ---------------
       [ALLE INFO MODALS HERSCHREVEN - KB V1.0 STANDAARD]
       - Alle modals naar two-line layout met checkboxes
       - Injecties: checkbox Kiesol MB (EUR 2,00/m)
       - Membraan: checkbox SNC-membraan (EUR 8,00/m2)
       - Bezetten: checkbox MP75 gipspleister (EUR 5,70/m2)
       - XPS: checkboxes plaat/L-gips/PU-schuim/Gitex/Snelband
       - Ultradun Sopro: checkboxes per laag + wapening
       - Ultradun Asocret: checkboxes mortel + Autex
       - Fix & Finish: checkbox Fix & Finish (EUR 2,61/m2)
       - Fassa Shield: checkboxes Shield/Superbond/Afwerking
       - Consistente V30.13/V30.18 styling voor alle modals
       - materialState uitgebreid voor alle componenten
       - Toggle functies per component toegevoegd
       - Bron: INFOMODAL_HERSCHRIJVING_KNOWLEDGE_BASE_V1_0
       
       CHANGELOG V9.21:
       ---------------
       [WEDI GITEX METHODE - V30.18 SYNC]
       - Dropdown: "Naden verstevigen" vs "Volledig oppervlak"
       - WEDI_GITEX_SYSTEMS met productiviteit/prijzen per methode
       - Naden: 30 m2/dag, Gitex 0,12 m²/m² = € 0,42
       - Volledig: 25 m2/dag, Gitex 1,10 m²/m² = € 3,85
       - Snelband variabel per methode (naden = 12% van volledig)
       - Info modal: toont gekozen methode en variabele prijzen
       - Capaciteit en materiaal dynamisch per methode
       - Consistent met Sales Calculator V30.18
       
       CHANGELOG V9.20:
       ---------------
       [MODAL TOTAL STYLING - V30.13]
       - .total-badge -> .modal-total
       - Verwijderd: blauwe achtergrond, border-radius
       - Toegevoegd: border-top 2px solid primary
       - Label: 14px, uppercase, var(--text)
       - Value: 18px, bold, var(--primary)
       - Consistent met Sales Calculator V30.13
       
       CHANGELOG V9.19:
       ---------------
       [SNELBAND CORRECTIE]
       - Laagdikte: 3mm (voor Gitex verankering)
       - Verbruik: 0,8 kg/mm x 3mm = 2,4 kg/m2
       - Prijs: EUR 14,00/25kg = € 0,56/kg
       - Kosten: 2,4 x 0,56 = € 1,34/m2 (was EUR 2,00)
       - Totaal 10mm: EUR 38,66 -> EUR 38,00 (-EUR 0,66)
       - Bron: Knauf datasheet + praktijk
       
       CHANGELOG V9.18:
       ---------------
       [MODAL MATERIAALKOSTEN VERDUIDELIJKING]
       - Two-line layout voor materiaal checkboxes
       - Regel 1: Checkbox + naam + prijs/m2
       - Regel 2: Verbruik x eenheidsprijs berekening
       - WEDI_MAT_BREAKDOWN uitgebreid met verbruik/eenheidsprijs
       - Nieuwe CSS classes: .mat-row, .mat-calc
       - Bron referentie: KB V1.4
       
       CHANGELOG V9.17:
       ---------------
       [FLEXLIJM CORRECTIE]
       - Verbruik: 14 kg/m2 -> 6,25 kg/m2 (praktijk: 4m2/zak)
       - Prijs: EUR 11,20 -> EUR 5,00 per m2
       - Bron: Hygroscopische KB + praktijkervaring
       - Impact Wedi totaal: -EUR 6,20/m2
       - 4mm: EUR 48,47 -> EUR 42,27
       - 6mm: EUR 46,03 -> EUR 39,83
       - 10mm: EUR 44,86 -> EUR 38,66
       
       CHANGELOG V9.16:
       ---------------
       [MATERIAAL CHECKBOXES - PROOF OF CONCEPT]
       - WEDI_MAT_BREAKDOWN: per-materiaal prijzen
       - materialState object voor checkbox states (sessie)
       - getWediMatPrijs(): effectieve prijs o.b.v. checkboxes
       - toggleWediMaterial(): toggle + herbereken
       - Info modal Wedi: checkboxes per materiaal
       - Uitvinken materiaal = € 0,00 (AQP levert)
       - Direct update componentkaart bij toggle
       
       CHANGELOG V9.15:
       ---------------
       [INFO MODAL CONTENT STYLING V30.13]
       - material-badge -> modal-section-title
       - info-list -> material-list
       - Consistente classnames met V30.13
       - Duplicate CSS verwijderd
       
       CHANGELOG V9.14:
       ---------------
       [INFO MODAL V30.13 STYLING]
       - Modal overlay systeem (fade-in animatie)
       - Sluiten knop onderaan (i.p.v. X rechtsboven)
       - Material-badge als section title
       - Info-list met > bullets
       - Escape toets sluit modal
       - Click buiten modal sluit
       
       CHANGELOG V9.13:
       ---------------
       [BEZETTEN MATERIAALKOST]
       - mat: 6.50 -> 5.70 (puur MP75, geen Snelband)
       - 15 kg/m² x € 0,38/kg = € 5,70/m2
       - Info modal ook aangepast naar 5.70
       
       CHANGELOG V9.12:
       ---------------
       [SELECT DROPDOWN TEXT FIX]
       - Override font-size: 18px -> 16px gefixed
       - padding-right: 30px toegevoegd (ruimte voor pijl)
       - Tekst "Met Autex glasvezelwapening" past nu volledig
       
       CHANGELOG V9.11:
       ---------------
       [INPUT/SELECT COMPACTER]
       - font-size: 18px -> 16px
       - padding: 8px 13px -> 8px 8px
       - Meer ruimte voor "Met Autex glasvezelwapening"
       
       CHANGELOG V9.10:
       ---------------
       [AUTEX DROPDOWN POSITIE]
       - Zie V9.10 voor details
       ============================================================ */

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* === CSS VARIABELEN === */
    :root {
        /* Brand Colors */
        --primary: #33b2d2;
        --primary-dark: #2a9bbf;
        
        /* Text */
        --text: #e5e5e5;
        --text-muted: #a0a0a0;
        
        /* Backgrounds */
        --bg: #1a1b1e;
        --card-bg: #25272b;
        --input-bg: #1e2023;
        
        /* Borders & Effects */
        --border: #3c4043;
        --card-shadow: none;
        --focus-ring: 0 0 0 3px rgba(51, 178, 210, 0.5);
        
        /* Dormant State */
        --dormant-bg: #1e2022;
        --dormant-border: #3c4043;
    }

    body:not(.dark-mode) {
        --text: #2d3748;
        --text-muted: #718096;
        --bg: #ffffff;
        --card-bg: #ffffff;
        --border: #e2e8f0;
        --input-bg: #f8fafc;
        --card-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
        --dormant-bg: #f8fafc;
        --dormant-border: #cbd5e0;
    }

    /* === ACCESSIBILITY === */
    .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: var(--primary);
        color: white;
        padding: 8px 16px;
        z-index: 1000;
        text-decoration: none;
        font-weight: 600;
        border-radius: 0 0 8px 0;
        transition: top 0.3s;
    }
    .skip-link:focus { top: 0; outline: none; }

    *:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
    }
    button:focus-visible, input:focus-visible, select:focus-visible {
        box-shadow: var(--focus-ring);
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* === LAYOUT === */
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.5;
        min-height: 100vh;
    }

    .container {
        max-width: 700px;
        margin: 0 auto;
        padding: 8px 10px;
    }

    /* === HEADER === */
    .header {
        max-width: 700px;
        margin: 0 auto;
        padding: 8px 10px;
        display: grid;
        grid-template-columns: auto 1fr auto;
        grid-template-rows: 36px 1fr;
        gap: 0 8px;
        margin-bottom: 4px;
        min-height: 86px;
    }

    .header-logo {
        grid-column: 1;
        grid-row: 1 / -1;
        width: 66px;
        height: 86px;
        display: flex;
        align-items: center;
    }
    .header-logo svg { width: 100%; height: 100%; }

    .logo-light { display: none; }
    .logo-dark { display: block; }
    body:not(.dark-mode) .logo-light { display: block; }
    body:not(.dark-mode) .logo-dark { display: none; }

    .header-title {
        grid-column: 2 / -1;
        grid-row: 2;
        color: var(--primary);
        font-size: 28px;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        white-space: nowrap;
    }

    .header-controls {
        grid-column: 3;
        grid-row: 1;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 8px;
    }

    /* Header Buttons - V3.0 styling: zonder cirkel */
    .header-btn {
        background: transparent;
        border: none;
        width: 20px;
        height: 20px;
        min-width: 36px;
        min-height: 36px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }
    .header-btn svg {
        width: 18px;
        height: 18px;
        stroke: var(--text-muted);
        fill: none;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
        transition: stroke 0.2s;
    }
    .header-btn:hover svg { stroke: var(--primary); }
    .header-btn.btn-flash svg { stroke: var(--primary); transition: none; }

    /* === COMPONENT CARDS === */
    .component-card {
        position: relative;
        background: var(--card-bg);
        border-radius: clamp(10px, 1.2vw, 14px);
        padding: 4px 10px;
        margin-bottom: 4px;
        border: 1px solid var(--border);
        border-left: 4px solid var(--primary);
        box-shadow: var(--card-shadow);
        display: flex;
        align-items: flex-end;
        gap: 6px;
        transition: background 0.3s ease, border-color 0.3s ease;
    }

    .component-card.dormant {
        border-left-color: var(--dormant-border);
        background: var(--dormant-bg);
    }

    .card-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: clamp(10px, 1.5vw, 16px);
        margin-bottom: 2px;
        padding-right: 30px;
    }

    .card-title {
        font-size: clamp(18px, 3vw, 24px);
        font-weight: 600;
        color: var(--text);
        flex: 1;
    }

    .price-badge {
        background: none;
        color: var(--primary);
        padding: 0;
        font-weight: 700;
        font-size: clamp(18px, 3vw, 24px);
        white-space: nowrap;
        margin-right: 10px;
    }

    .dormant .price-badge {
        color: var(--text-muted);
    }

    /* Info Button - V3.0 styling */
    .info-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        border: none;
        background: transparent;
        color: var(--text-muted);
        font-size: 14px;
        font-weight: 700;
        font-style: italic;
        font-family: Georgia, serif;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s;
        z-index: 10;
        padding: 0;
        line-height: 1;
    }
    .info-btn:hover,
    .info-btn:focus {
        color: var(--primary);
    }
    .info-btn:focus {
        outline: none;
    }

    /* === INPUT FIELDS - V3.0 PARITY === */
    .input-stack {
        display: flex;
        flex-direction: column;
        gap: 2px;
        width: 100%;
    }

    .input-wrapper {
        position: relative;
        width: 100%;
    }

    .input-wrapper input:not([type="checkbox"]),
    .input-wrapper select {
        width: 100%;
        height: 38px;
        padding: 8px 8px;
        border: 2px solid var(--border);
        border-radius: 8px;
        background: var(--card-bg);
        color: var(--text);
        font-size: 16px;
        font-weight: 600;
        line-height: normal;
        transition: border-color 0.3s;
        -webkit-appearance: none;
        appearance: none;
    }

    .input-wrapper input:focus,
    .input-wrapper select:focus {
        outline: none;
        border-color: var(--primary);
    }

    .input-wrapper input::placeholder {
        color: #9ca3af;
        font-size: 17px;
        font-weight: 500;
    }

    .input-wrapper input[type="number"]::-webkit-inner-spin-button,
    .input-wrapper input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    .input-wrapper input[type="number"] {
        -moz-appearance: textfield;
    }

    /* V3.0 Unit & Label Inside Pattern - LINKS gepositioneerd */
    .unit-inside, .label-inside {
        position: absolute;
        left: 13px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        font-size: 13px;
        font-weight: 400;
        pointer-events: none;
        display: none;
        background: var(--card-bg);
        white-space: nowrap;
    }
    .label-inside { color: #9ca3af; }
    
    /* Show when input has value */
    .input-wrapper input:not(:placeholder-shown) ~ .unit-inside,
    .input-wrapper input:not(:placeholder-shown) ~ .label-inside {
        display: block;
    }
    /* Hide in dormant state */
    .dormant .unit-inside, .dormant .label-inside { display: none !important; }

    /* Select Styling - V3.0 met SVG arrow */
    .input-wrapper select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23535554' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        cursor: pointer;
    }
    body.dark-mode .input-wrapper select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0a0' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    }
    .input-wrapper select.placeholder-active {
        font-size: 17px;
        font-weight: 500;
        color: #9ca3af;
    }
    .input-wrapper.select-wrapper select:not(.placeholder-active) {
        font-size: 16px;
        font-weight: 600;
        color: var(--text);
        padding-right: 30px;
    }
    .input-wrapper select:not(.placeholder-active) ~ .unit-inside,
    .input-wrapper select:not(.placeholder-active) ~ .label-inside { display: block; }
    .input-wrapper.select-wrapper select.placeholder-active ~ .unit-inside,
    .input-wrapper.select-wrapper select.placeholder-active ~ .label-inside { display: none !important; }
    .input-wrapper select option {
        color: var(--text);
        font-size: 18px;
        background: var(--card-bg);
    }

    /* V9.2: Autex Checkbox Styling - Identiek aan Sales Calculator V30.7 */
    .input-wrapper.checkbox-standalone {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0;
        margin: 0;
    }
    .input-wrapper.checkbox-standalone input[type="checkbox"] {
        -webkit-appearance: none;
        appearance: none;
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        flex-shrink: 0;
        margin: 0;
        padding: 0;
        cursor: pointer;
        border: 2px solid var(--border);
        border-radius: 6px;
        background: var(--card-bg);
        transition: border-color 0.3s, background-color 0.3s;
        position: relative;
    }
    .input-wrapper.checkbox-standalone input[type="checkbox"]:hover {
        border-color: var(--border);
    }
    .input-wrapper.checkbox-standalone input[type="checkbox"]:checked {
        border-color: var(--border);
        background-color: var(--card-bg);
    }
    .input-wrapper.checkbox-standalone input[type="checkbox"]:checked::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 45%;
        transform: translate(-50%, -50%) rotate(45deg);
        width: 6px;
        height: 12px;
        border: solid var(--primary);
        border-width: 0 2px 2px 0;
    }
    .input-wrapper.checkbox-standalone .checkbox-label {
        font-size: clamp(13px, 1.4vw, 15px);
        color: var(--text);
        cursor: pointer;
        user-select: none;
        line-height: 32px;
    }
    .autex-option {
        margin-top: 2px;
    }

    /* === BREAKDOWN - V9.4 Compact zoals V30.7 === */
    .breakdown {
        display: none;
        font-size: 13px;
        margin-top: 4px;
        padding-top: 4px;
        border-top: 1px solid var(--border);
    }

    .breakdown.show {
        display: block;
    }

    .breakdown-row {
        display: flex;
        justify-content: space-between;
        padding: 2px 0;
        color: var(--text-muted);
    }

    .breakdown-row.total {
        font-weight: 700;
        color: var(--primary);
        border-top: 1px solid var(--border);
        margin-top: 2px;
        padding-top: 4px;
    }

    /* === EXTRA SECTION - V9.4 Compact zoals V30.7 === */
    .extra-section {
        margin-bottom: clamp(8px, 1.2vw, 12px);
    }
    /* V9.4: Extra sectie cards compacter zoals V30.7 */
    .extra-section .card-content { gap: 2px; }
    .extra-section .card-title { font-size: clamp(15px, 2.4vw, 20px); margin-bottom: 2px; }
    .extra-section .component-card { margin-bottom: 4px; }

    .section-header {
        background: transparent;
        color: var(--text);
        padding: clamp(6px, 1vw, 10px) 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: clamp(18px, 3vw, 24px);
        font-weight: 600;
        transition: color 0.2s;
        border: none;
        width: 100%;
        text-align: left;
    }
    .section-header:hover .section-toggle::after { color: var(--primary-dark); }

    .section-toggle::after {
        content: '+';
        font-size: clamp(18px, 3vw, 24px);
        font-weight: 600;
        color: var(--primary);
    }
    .section-header.expanded .section-toggle::after {
        content: '-';
    }

    .section-content {
        display: none;
        padding-top: clamp(8px, 1.2vw, 12px);
    }
    .section-content.show {
        display: block;
    }

    /* === SUMMARY CARD === */
    .summary-card {
        background: var(--card-bg);
        border: 3px solid var(--primary);
        border-radius: 12px;
        padding: 8px;
        margin-top: 4px;
        box-shadow: var(--card-shadow);
        transition: opacity 0.3s ease, border-color 0.3s ease;
    }

    .summary-card.dormant {
        border-color: var(--dormant-border);
        opacity: 0.5;
    }
    
    /* Dormant state: verberg alles behalve titel en totaal */
    .summary-card.dormant .summary-section-title,
    .summary-card.dormant .summary-row,
    .summary-card.dormant .summary-divider {
        display: none;
    }
    .summary-card.dormant .summary-title {
        margin-bottom: 0;
    }
    .summary-card.dormant .summary-total {
        margin-top: 8px;
        padding-top: 8px;
    }

    .summary-title {
        color: var(--primary);
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .summary-section-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
        margin-top: 12px;
        margin-bottom: 4px;
    }
    .summary-section-title:first-of-type { margin-top: 0; }

    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        font-size: 14px;
        color: var(--text-muted);
        border-bottom: 1px solid var(--border);
    }
    .summary-row:last-of-type { border-bottom: none; }
    .summary-row span:last-child { 
        color: var(--text); 
        font-weight: 600; 
    }
    .summary-row.indented { padding-left: 12px; }

    .summary-divider {
        border-top: 2px solid var(--primary);
        margin: 12px 0;
    }

    .summary-total {
        display: flex;
        justify-content: center;
        align-items: center;
        padding-top: 12px;
        border-top: 2px solid var(--primary);
        margin-top: 12px;
    }
    .summary-total .value {
        font-size: 22px;
        font-weight: 900;
        color: var(--primary);
    }

    /* === INVOICE OVERVIEW === */
    .invoice-card {
        background: var(--card-bg);
        border: 3px solid var(--primary);
        border-radius: 12px;
        padding: 8px;
        margin-top: 4px;
        box-shadow: var(--card-shadow);
        transition: opacity 0.3s ease, border-color 0.3s ease;
    }

    .invoice-card.dormant {
        border-color: var(--dormant-border);
        opacity: 0.5;
    }
    
    /* Dormant state: verberg items, toon alleen titel en totaal */
    .invoice-card.dormant #invoice-items {
        display: none;
    }
    .invoice-card.dormant .invoice-title {
        margin-bottom: 0;
    }
    .invoice-card.dormant .invoice-total {
        margin-top: 8px;
    }

    .invoice-title {
        color: var(--primary);
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .invoice-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
        font-size: 14px;
        border-bottom: 1px solid var(--border);
    }
    .invoice-row:last-of-type { border-bottom: none; }

    .invoice-row .component-name {
        font-weight: 600;
        color: var(--text);
        flex: 1;
    }
    .invoice-row .component-calc {
        color: var(--text-muted);
        margin: 0 10px;
        font-size: 13px;
    }
    .invoice-row .component-total {
        font-weight: 700;
        color: var(--text);
        min-width: 90px;
        text-align: right;
    }

    .invoice-total {
        font-size: 22px;
        font-weight: 900;
        text-align: center;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 2px solid var(--primary);
        color: var(--primary);
    }

    /* === MODAL === */
    /* Modal Overlay - V30.13 Styling */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        padding: 16px;
    }
    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    /* Modal Card */
    .info-modal {
        background: var(--card-bg);
        border-radius: 12px;
        max-width: 420px;
        width: 100%;
        max-height: 80vh;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        transform: scale(0.9) translateY(20px);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        border: 1px solid var(--border);
    }
    .modal-overlay.active .info-modal {
        transform: scale(1) translateY(0);
    }
    
    /* Modal Header */
    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
        background: var(--card-bg);
    }
    .modal-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
    }
    
    /* Modal Body */
    .modal-body {
        padding: 16px;
        overflow-y: auto;
        flex: 1;
    }
    
    /* Section Title */
    .modal-section-title {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-muted);
        margin-bottom: 10px;
    }
    
    /* Material List */
    .material-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .material-list li {
        padding: 8px 0;
        font-size: 14px;
        color: var(--text);
        display: flex;
        align-items: flex-start;
        gap: 8px;
        border-bottom: 1px solid var(--border);
    }
    .material-list li:last-child {
        border-bottom: none;
    }
    .material-list li::before {
        content: ">";
        color: var(--primary);
        font-weight: 700;
        flex-shrink: 0;
    }
    .material-brand {
        color: var(--text-muted);
        font-size: 13px;
    }
    .material-product {
        font-weight: 600;
    }
    
    /* No Materials Note */
    .no-materials {
        color: var(--text-muted);
        font-size: 14px;
        font-style: italic;
        padding: 8px 0;
    }
    
    /* Subsystem styling */
    .subsystem-title {
        font-size: 12px;
        font-weight: 600;
        color: var(--primary);
        margin: 12px 0 8px 0;
        padding-top: 8px;
        border-top: 1px solid var(--border);
    }
    .subsystem-title:first-child {
        margin-top: 0;
        padding-top: 0;
        border-top: none;
    }
    
    /* V9.20: Modal Total - V30.13 Style */
    .modal-total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0 4px 0;
        border-top: 2px solid var(--primary);
        margin-top: 16px;
    }
    .modal-total .total-label {
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .modal-total .total-value {
        font-size: 18px;
        font-weight: 700;
        color: var(--primary);
    }
    
    /* Modal Close Button */
    .modal-close {
        display: block;
        width: 100%;
        padding: 12px;
        background: transparent;
        border: none;
        border-top: 1px solid var(--border);
        color: var(--text-muted);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .modal-close:hover {
        background: var(--primary);
        color: white;
    }
    
    /* Info Section wrapper */
    .info-section {
        margin-bottom: 0;
    }
    
    /* V9.18: Material Checkbox Styling - Two-line layout */
    .material-checkbox-list {
        list-style: none;
        padding: 0;
        margin: 0 0 12px 0;
    }
    .material-checkbox-item {
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }
    .material-checkbox-item:last-child {
        border-bottom: none;
    }
    .material-checkbox-item .mat-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .material-checkbox-item label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        flex: 1;
    }
    .material-checkbox-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--primary);
        cursor: pointer;
        flex-shrink: 0;
    }
    .material-checkbox-item .mat-name {
        color: var(--text);
        font-weight: 500;
    }
    .material-checkbox-item .mat-price {
        color: var(--primary);
        font-weight: 600;
        white-space: nowrap;
    }
    .material-checkbox-item .mat-calc {
        margin-left: 28px;
        margin-top: 4px;
        font-size: 12px;
        color: var(--text-muted);
    }
    .material-checkbox-item.disabled label {
        opacity: 0.5;
        text-decoration: line-through;
    }
    .material-checkbox-item.disabled .mat-price {
        color: var(--text-muted);
    }
    .material-checkbox-item.disabled .mat-calc {
        opacity: 0.5;
    }

    /* === FOOTER - V3.0 STYLING === */
    .summary-footer {
        text-align: right;
        padding-top: 1px;
        padding-right: 10px;
        color: var(--text-muted);
        font-size: 8px;
    }

    /* === PRINT STYLES === */
    @media print {
        .header-controls, .section-header, .skip-link, .info-btn { display: none !important; }
        body { background: white; color: black; }
        .component-card, .summary-card, .invoice-card {
            box-shadow: none;
            border-color: #ccc;
        }
    }
    </style>
</head>
<body class="dark-mode">
    <!-- Skip Link -->
    <a href="#main-content" class="skip-link">Ga naar inhoud</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-logo">
            <!-- Logo Zwart (light mode) - Volledig officieel logo -->
            <svg class="logo-light" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 174.77 229.38">
              <defs>
                <style>
                  .stl0 { fill: url(#lg-light-2); }
                  .stl1 { fill: url(#lg-light-10); }
                  .stl2 { fill: url(#lg-light-21); }
                  .stl3 { fill: url(#lg-light-27); }
                  .stl4 { fill: url(#lg-light-26); }
                  .stl5 { fill: url(#lg-light-1); }
                  .stl6 { fill: url(#lg-light-9); }
                  .stl7 { fill: url(#lg-light-18); }
                  .stl8 { fill: url(#lg-light-23); }
                  .stl9 { fill: url(#lg-light-8); }
                  .stl10 { fill: url(#lg-light-11); }
                  .stl11 { fill: none; }
                  .stl12 { fill: url(#lg-light-16); }
                  .stl13 { fill: url(#lg-light-24); }
                  .stl14 { fill: url(#lg-light-3); stroke: #fff; stroke-miterlimit: 10; stroke-width: 8.31px; }
                  .stl15 { fill: #595857; }
                  .stl16 { fill: url(#lg-light-22); }
                  .stl17 { fill: url(#lg-light-29); }
                  .stl18 { fill: url(#lg-light-19); }
                  .stl19 { fill: url(#lg-light-12); }
                  .stl20 { opacity: .89; }
                  .stl21 { fill: url(#lg-light-28); }
                  .stl22 { fill: url(#lg-light-7); }
                  .stl23 { opacity: .56; }
                  .stl24 { fill: url(#lg-light-20); }
                  .stl25 { fill: url(#lg-light-4); }
                  .stl26 { fill: url(#lg-light-14); }
                  .stl27 { fill: url(#lg-light-5); }
                  .stl28 { fill: url(#lg-light-25); }
                  .stl29 { opacity: .77; }
                  .stl30 { fill: url(#lg-light-15); }
                  .stl31 { fill: url(#lg-light-17); }
                  .stl32 { fill: url(#lg-light-6); }
                  .stl33 { fill: url(#lg-light-13); }
                  .stl34 { fill: url(#lg-light-); }
                  .stl35 { clip-path: url(#clippath-light); }
                  .stl36 { opacity: .82; }
                </style>
                <clipPath id="clippath-light">
                  <path class="stl11" d="M117.81,182.78c0,18.65-15.67,33.58-30.25,33.58-16.92,0-30.63-13.85-30.63-33.2s13.71-33.77,30.63-33.77,30.25,14.73,30.25,33.38Z"/>
                </clipPath>
                <linearGradient id="lg-light-" x1="87.56" y1="151.81" x2="87.56" y2="211.1" gradientUnits="userSpaceOnUse">
                  <stop offset="0" stop-color="#fff"/>
                  <stop offset="1" stop-color="#41b0d4"/>
                </linearGradient>
                <linearGradient id="lg-light-1" x1="87.67" y1="151.81" x2="87.67" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-2" x1="87.88" y1="151.81" x2="87.88" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-3" x1="116.4" y1="198.14" x2="116.4" y2="198.14" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-4" x1="87.98" y1="151.81" x2="87.98" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-5" x1="60.13" y1="151.81" x2="60.13" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-6" x1="67.28" y1="151.81" x2="67.28" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-7" x1="63.7" y1="151.81" x2="63.7" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-8" x1="67.28" y1="151.81" x2="67.28" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-9" x1="75.83" y1="151.81" x2="75.83" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-10" x1="71.49" y1="151.81" x2="71.49" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-11" x1="75.83" y1="151.81" x2="75.83" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-12" x1="84.17" y1="151.81" x2="84.17" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-13" x1="80.18" y1="151.81" x2="80.18" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-14" x1="84.17" y1="151.81" x2="84.17" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-15" x1="84.3" y1="151.81" x2="84.3" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-16" x1="91.87" y1="151.81" x2="91.87" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-17" x1="87.88" y1="151.81" x2="87.88" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-18" x1="84.3" y1="151.81" x2="84.3" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-19" x1="91.87" y1="151.81" x2="91.87" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-20" x1="100.28" y1="151.81" x2="100.28" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-21" x1="95.91" y1="151.81" x2="95.91" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-22" x1="100.28" y1="151.81" x2="100.28" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-23" x1="108.35" y1="151.81" x2="108.35" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-24" x1="104.27" y1="151.81" x2="104.27" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-25" x1="108.35" y1="151.81" x2="108.35" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-26" x1="115.71" y1="151.81" x2="115.71" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-27" x1="112.13" y1="151.81" x2="112.13" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-28" x1="115.71" y1="151.81" x2="115.71" y2="211.1" xlink:href="#lg-light-"/>
                <linearGradient id="lg-light-29" x1="60.13" y1="151.81" x2="60.13" y2="211.1" xlink:href="#lg-light-"/>
              </defs>
              <g id="Linksboven">
                <g>
                  <g class="stl20">
                    <polygon class="stl15" points="10.32 115.67 45.26 37.87 69.43 81.72 71.21 78.38 46.58 33.8 43.8 33.8 5.2 118.67 8.83 118.67 18 118.67 50.06 118.67 51.73 115.67 10.32 115.67"/>
                    <path class="stl15" d="M131.59,6.77h-3.78c-31.54,71.25-49.7,108.9-61.09,134.47-9.95,22.32-15.43,32.06-16.29,41.78-.92,10.39,2.82,20.75,10.51,29.15,7.43,8.1,17.36,11.12,26.57,11.12,17.15,0,37.09-16.49,37.09-40.12,0-13.38-9.19-30.13-18.92-47.86-1.61-2.93-4.39-8.48-5.97-11.41l-1.98,4.29c1.58,2.94,3.2,5.9,4.82,8.84,9.5,17.32,18.48,33.68,18.48,46.14,0,21.61-18.01,36.54-33.51,36.54-8.22,0-17.17-2.58-23.93-9.96-7-7.65-10.41-17.03-9.59-26.42.8-9.07,6.43-18.53,15.95-40.54,11.74-27.13,28.55-59.66,60.27-133.1h1.38c16.1,0,34.66,11.19,34.66,34.42,0,16.47-14.25,35.46-34.89,35.46h-11.04l-1.68,3.43h12.72c21.98,0,38.71-19.84,38.71-38.89,0-25.47-19.81-37.35-38.48-37.35Z"/>
                  </g>
                  <g class="stl35">
                    <g class="stl29">
                      <rect class="stl34" x="56.82" y="186.79" width="61.47" height="1.66"/>
                    </g>
                    <g class="stl29">
                      <rect class="stl5" x="55.9" y="190.14" width="63.55" height="3.32"/>
                    </g>
                    <g class="stl29">
                      <rect class="stl0" x="56.59" y="194.71" width="62.58" height="3.32"/>
                    </g>
                    <g class="stl23">
                      <path class="stl14" d="M116.4,198.14"/>
                    </g>
                    <g class="stl36">
                      <path class="stl25" d="M58.73,199.53l58.5-.28s-32.09,43.15-58.5.28Z"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl27" cx="60.13" cy="183.16" r="1.05"/>
                      <circle class="stl32" cx="67.28" cy="183.16" r="1.05"/>
                      <circle class="stl22" cx="63.7" cy="179.58" r="1.05"/>
                      <circle class="stl9" cx="67.28" cy="176" r="1.05"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl6" cx="75.83" cy="183.1" r="1.05"/>
                      <circle class="stl1" cx="71.49" cy="179.53" r="1.05"/>
                      <circle class="stl10" cx="75.83" cy="175.95" r="1.05"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl19" cx="84.17" cy="183.16" r="1.05"/>
                      <circle class="stl33" cx="80.18" cy="179.58" r="1.05"/>
                      <circle class="stl26" cx="84.17" cy="176" r="1.05"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl30" cx="84.3" cy="183.1" r="1.05"/>
                      <circle class="stl12" cx="91.87" cy="183.1" r="1.05"/>
                      <circle class="stl31" cx="87.88" cy="179.53" r="1.05"/>
                      <circle class="stl7" cx="84.3" cy="175.95" r="1.05"/>
                      <circle class="stl18" cx="91.87" cy="175.95" r="1.05"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl24" cx="100.28" cy="183.16" r="1.05"/>
                      <circle class="stl2" cx="95.91" cy="179.47" r="1.05"/>
                      <circle class="stl16" cx="100.28" cy="175.95" r="1.05"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl8" cx="108.35" cy="183.16" r="1.05"/>
                      <circle class="stl13" cx="104.27" cy="179.47" r="1.05"/>
                      <circle class="stl28" cx="108.35" cy="175.95" r="1.05"/>
                    </g>
                    <g class="stl36">
                      <circle class="stl4" cx="115.71" cy="183.15" r="1.05"/>
                      <circle class="stl3" cx="112.13" cy="179.57" r="1.05"/>
                      <circle class="stl21" cx="115.71" cy="175.99" r="1.05"/>
                    </g>
                    <circle class="stl17" cx="60.13" cy="175.95" r="1.05"/>
                  </g>
                </g>
              </g>
            </svg>
            <!-- Logo Wit (dark mode) - Volledig officieel logo -->
            <svg class="logo-dark" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 180.19 238.52">
              <defs>
                <style>
                  .std0 { fill: url(#lg-dark-2); }
                  .std1 { fill: url(#lg-dark-10); }
                  .std2 { fill: url(#lg-dark-21); }
                  .std3 { fill: url(#lg-dark-27); }
                  .std4 { fill: #fff; }
                  .std5 { fill: url(#lg-dark-26); }
                  .std6 { fill: url(#lg-dark-1); }
                  .std7 { fill: url(#lg-dark-9); }
                  .std8 { fill: url(#lg-dark-18); }
                  .std9 { fill: url(#lg-dark-23); }
                  .std10 { fill: url(#lg-dark-8); }
                  .std11 { fill: url(#lg-dark-11); }
                  .std12 { fill: none; }
                  .std13 { fill: url(#lg-dark-16); }
                  .std14 { fill: url(#lg-dark-24); }
                  .std15 { fill: url(#lg-dark-3); stroke: #fff; stroke-miterlimit: 10; stroke-width: 8.31px; }
                  .std16 { fill: url(#lg-dark-22); }
                  .std17 { fill: url(#lg-dark-29); }
                  .std18 { fill: url(#lg-dark-19); }
                  .std19 { fill: url(#lg-dark-12); }
                  .std20 { opacity: .89; }
                  .std21 { fill: url(#lg-dark-28); }
                  .std22 { fill: url(#lg-dark-7); }
                  .std23 { opacity: .56; }
                  .std24 { fill: url(#lg-dark-20); }
                  .std25 { fill: url(#lg-dark-4); }
                  .std26 { fill: url(#lg-dark-14); }
                  .std27 { fill: url(#lg-dark-5); }
                  .std28 { fill: url(#lg-dark-25); }
                  .std29 { opacity: .77; }
                  .std30 { fill: url(#lg-dark-15); }
                  .std31 { fill: url(#lg-dark-17); }
                  .std32 { fill: url(#lg-dark-6); }
                  .std33 { display: none; fill: #1a1a1e; }
                  .std34 { fill: url(#lg-dark-13); }
                  .std35 { fill: url(#lg-dark-); }
                  .std36 { clip-path: url(#clippath-dark); }
                  .std37 { opacity: .82; }
                </style>
                <clipPath id="clippath-dark">
                  <path class="std12" d="M119.82,184.32c0,18.65-15.67,33.58-30.25,33.58-16.92,0-30.63-13.85-30.63-33.2s13.71-33.77,30.63-33.77,30.25,14.73,30.25,33.38Z"/>
                </clipPath>
                <linearGradient id="lg-dark-" x1="89.57" y1="153.35" x2="89.57" y2="212.64" gradientUnits="userSpaceOnUse">
                  <stop offset="0" stop-color="#fff"/>
                  <stop offset="1" stop-color="#41b0d4"/>
                </linearGradient>
                <linearGradient id="lg-dark-1" x1="89.68" y1="153.35" x2="89.68" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-2" x1="89.89" y1="153.35" x2="89.89" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-3" x1="118.41" y1="199.69" x2="118.41" y2="199.69" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-4" x1="90" y1="153.35" x2="90" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-5" x1="62.14" y1="153.35" x2="62.14" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-6" x1="69.3" y1="153.35" x2="69.3" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-7" x1="65.72" y1="153.35" x2="65.72" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-8" x1="69.3" y1="153.35" x2="69.3" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-9" x1="77.85" y1="153.35" x2="77.85" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-10" x1="73.51" y1="153.35" x2="73.51" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-11" x1="77.85" y1="153.35" x2="77.85" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-12" x1="86.19" y1="153.35" x2="86.19" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-13" x1="82.19" y1="153.35" x2="82.19" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-14" x1="86.19" y1="153.35" x2="86.19" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-15" x1="86.31" y1="153.35" x2="86.31" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-16" x1="93.88" y1="153.35" x2="93.88" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-17" x1="89.89" y1="153.35" x2="89.89" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-18" x1="86.31" y1="153.35" x2="86.31" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-19" x1="93.88" y1="153.35" x2="93.88" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-20" x1="102.3" y1="153.35" x2="102.3" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-21" x1="97.92" y1="153.35" x2="97.92" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-22" x1="102.3" y1="153.35" x2="102.3" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-23" x1="110.36" y1="153.35" x2="110.36" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-24" x1="106.28" y1="153.35" x2="106.28" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-25" x1="110.36" y1="153.35" x2="110.36" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-26" x1="117.72" y1="153.35" x2="117.72" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-27" x1="114.14" y1="153.35" x2="114.14" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-28" x1="117.72" y1="153.35" x2="117.72" y2="212.64" xlink:href="#lg-dark-"/>
                <linearGradient id="lg-dark-29" x1="62.14" y1="153.35" x2="62.14" y2="212.64" xlink:href="#lg-dark-"/>
              </defs>
              <rect id="Achtergrond_-_zwart" class="std33" x="-43.04" y="-10.29" width="614.97" height="269.58"/>
              <g id="Linksboven">
                <g>
                  <g class="std20">
                    <polygon class="std4" points="12.33 117.21 47.27 39.41 71.44 83.27 73.22 79.93 48.6 35.34 45.82 35.34 7.21 120.21 10.85 120.21 20.01 120.21 52.07 120.21 53.74 117.21 12.33 117.21"/>
                    <path class="std4" d="M133.6,8.32h-3.78c-31.54,71.25-49.7,108.9-61.09,134.47-9.95,22.32-15.43,32.06-16.29,41.78-.92,10.39,2.82,20.75,10.51,29.15,7.43,8.1,17.36,11.12,26.57,11.12,17.15,0,37.09-16.49,37.09-40.12,0-13.38-9.19-30.13-18.92-47.86-1.61-2.93-4.39-8.48-5.97-11.41l-1.98,4.29c1.58,2.94,3.2,5.9,4.82,8.84,9.5,17.32,18.48,33.68,18.48,46.14,0,21.61-18.01,36.54-33.51,36.54-8.22,0-17.17-2.58-23.93-9.96-7-7.65-10.41-17.03-9.59-26.42.8-9.07,6.43-18.53,15.95-40.54,11.74-27.13,28.55-59.66,60.27-133.1h1.38c16.1,0,34.66,11.19,34.66,34.42,0,16.47-14.25,35.46-34.89,35.46h-11.04l-1.68,3.43h12.72c21.98,0,38.71-19.84,38.71-38.89,0-25.47-19.81-37.35-38.48-37.35Z"/>
                  </g>
                  <g class="std36">
                    <g class="std29">
                      <rect class="std35" x="58.83" y="188.34" width="61.47" height="1.66"/>
                    </g>
                    <g class="std29">
                      <rect class="std6" x="57.91" y="191.68" width="63.55" height="3.32"/>
                    </g>
                    <g class="std29">
                      <rect class="std0" x="58.6" y="196.25" width="62.58" height="3.32"/>
                    </g>
                    <g class="std23">
                      <path class="std15" d="M118.41,199.69"/>
                    </g>
                    <g class="std37">
                      <path class="std25" d="M60.75,201.07l58.5-.28s-32.09,43.15-58.5.28Z"/>
                    </g>
                    <g class="std37">
                      <circle class="std27" cx="62.14" cy="184.7" r="1.05"/>
                      <circle class="std32" cx="69.3" cy="184.7" r="1.05"/>
                      <circle class="std22" cx="65.72" cy="181.13" r="1.05"/>
                      <circle class="std10" cx="69.3" cy="177.55" r="1.05"/>
                    </g>
                    <g class="std37">
                      <circle class="std7" cx="77.85" cy="184.65" r="1.05"/>
                      <circle class="std1" cx="73.51" cy="181.07" r="1.05"/>
                      <circle class="std11" cx="77.85" cy="177.49" r="1.05"/>
                    </g>
                    <g class="std37">
                      <circle class="std19" cx="86.19" cy="184.7" r="1.05"/>
                      <circle class="std34" cx="82.19" cy="181.13" r="1.05"/>
                      <circle class="std26" cx="86.19" cy="177.55" r="1.05"/>
                    </g>
                    <g class="std37">
                      <circle class="std30" cx="86.31" cy="184.65" r="1.05"/>
                      <circle class="std13" cx="93.88" cy="184.65" r="1.05"/>
                      <circle class="std31" cx="89.89" cy="181.07" r="1.05"/>
                      <circle class="std8" cx="86.31" cy="177.49" r="1.05"/>
                      <circle class="std18" cx="93.88" cy="177.49" r="1.05"/>
                    </g>
                    <g class="std37">
                      <circle class="std24" cx="102.3" cy="184.7" r="1.05"/>
                      <circle class="std2" cx="97.92" cy="181.01" r="1.05"/>
                      <circle class="std16" cx="102.3" cy="177.49" r="1.05"/>
                    </g>
                    <g class="std37">
                      <circle class="std9" cx="110.36" cy="184.7" r="1.05"/>
                      <circle class="std14" cx="106.28" cy="181.01" r="1.05"/>
                      <circle class="std28" cx="110.36" cy="177.49" r="1.05"/>
                    </g>
                    <g class="std37">
                      <circle class="std5" cx="117.72" cy="184.69" r="1.05"/>
                      <circle class="std3" cx="114.14" cy="181.12" r="1.05"/>
                      <circle class="std21" cx="117.72" cy="177.54" r="1.05"/>
                    </g>
                    <circle class="std17" cx="62.14" cy="177.49" r="1.05"/>
                  </g>
                </g>
              </g>
            </svg>
        </div>
        <h1 class="header-title">Subcalculator</h1>
        <div class="header-controls">
            <button type="button" id="theme-toggle-btn" class="header-btn" 
                    aria-label="Wissel thema">
                <svg id="theme-icon" viewBox="0 0 24 24" 
                     aria-hidden="true" focusable="false">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button type="button" id="reset-btn" class="header-btn" 
                    aria-label="Reset calculator">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <main id="main-content" role="main">

            <!-- Hoofdcomponenten -->
            <div class="components-grid">
                
                <!-- Afkappen -->
                <section class="component-card dormant" id="card-afkappen" 
                         aria-labelledby="title-afkappen">
                    <button type="button" class="info-btn" tabindex="-1"
                            onclick="showInfo('afkappen')" aria-label="Info afkappen">i</button>
                    <div class="card-content">
                        <div class="card-header">
                            <h2 class="card-title" id="title-afkappen">Afkappen</h2>
                            <span class="price-badge" id="price-afkappen">€ 0,00/m²</span>
                        </div>
                        <div class="input-stack">
                            <div class="input-wrapper">
                                <label for="afkappen" class="sr-only">Afkappen oppervlakte in m²</label>
                                <input type="text" id="afkappen" 
                                       inputmode="decimal"
                                       placeholder="Afkappen oppervlakte (m²)"
                                       data-field="afkappen"
                                       autocomplete="off"
                                       enterkeyhint="next">
                                <span class="unit-inside" aria-hidden="true">m²</span>
                                <span class="label-inside" aria-hidden="true">afkappen oppervlakte</span>
                            </div>
                        </div>
                        <div class="breakdown" id="breakdown-afkappen">
                            <div class="breakdown-row">
                                <span>Materiaal:</span>
                                <span id="mat-afkappen">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Arbeid:</span>
                                <span id="arb-afkappen">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Tijd:</span>
                                <span id="tijd-afkappen">0u 0m</span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Totaal:</span>
                                <span id="tot-afkappen">€ 0</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Injecties -->
                <section class="component-card dormant" id="card-injecties" 
                         aria-labelledby="title-injecties">
                    <button type="button" class="info-btn" tabindex="-1"
                            onclick="showInfo('injecties')" aria-label="Info injecties">i</button>
                    <div class="card-content">
                        <div class="card-header">
                            <h2 class="card-title" id="title-injecties">Injecties</h2>
                            <span class="price-badge" id="price-injecties">€ 0,00/m</span>
                        </div>
                        <div class="input-stack">
                            <div class="input-wrapper">
                                <label for="injecties" class="sr-only">Injecties lengte in m</label>
                                <input type="text" id="injecties" 
                                       inputmode="decimal"
                                       placeholder="Injecties lengte (m)"
                                       data-field="injecties"
                                       autocomplete="off"
                                       enterkeyhint="next">
                                <span class="unit-inside" aria-hidden="true">m</span>
                                <span class="label-inside" aria-hidden="true">injecties lengte</span>
                            </div>
                        </div>
                        <div class="breakdown" id="breakdown-injecties">
                            <div class="breakdown-row">
                                <span>Materiaal:</span>
                                <span id="mat-injecties">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Arbeid:</span>
                                <span id="arb-injecties">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Tijd:</span>
                                <span id="tijd-injecties">0u 0m</span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Totaal:</span>
                                <span id="tot-injecties">€ 0</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Membraan -->
                <section class="component-card dormant" id="card-membraan" 
                         aria-labelledby="title-membraan">
                    <button type="button" class="info-btn" tabindex="-1"
                            onclick="showInfo('membraan')" aria-label="Info membraan">i</button>
                    <div class="card-content">
                        <div class="card-header">
                            <h2 class="card-title" id="title-membraan">SNC-membraan</h2>
                            <span class="price-badge" id="price-membraan">€ 0,00/m²</span>
                        </div>
                        <div class="input-stack">
                            <div class="input-wrapper">
                                <label for="membraan" class="sr-only">Membraan oppervlakte in m²</label>
                                <input type="text" id="membraan" 
                                       inputmode="decimal"
                                       placeholder="Membraan oppervlakte (m²)"
                                       data-field="membraan"
                                       autocomplete="off"
                                       enterkeyhint="next">
                                <span class="unit-inside" aria-hidden="true">m²</span>
                                <span class="label-inside" aria-hidden="true">membraan oppervlakte</span>
                            </div>
                        </div>
                        <div class="breakdown" id="breakdown-membraan">
                            <div class="breakdown-row">
                                <span>Materiaal:</span>
                                <span id="mat-membraan">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Arbeid:</span>
                                <span id="arb-membraan">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Tijd:</span>
                                <span id="tijd-membraan">0u 0m</span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Totaal:</span>
                                <span id="tot-membraan">€ 0</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Bezetten -->
                <section class="component-card dormant" id="card-bezetten" 
                         aria-labelledby="title-bezetten">
                    <button type="button" class="info-btn" tabindex="-1"
                            onclick="showInfo('bezetten')" aria-label="Info bezetten">i</button>
                    <div class="card-content">
                        <div class="card-header">
                            <h2 class="card-title" id="title-bezetten">Bezetten</h2>
                            <span class="price-badge" id="price-bezetten">€ 0,00/m²</span>
                        </div>
                        <div class="input-stack">
                            <div class="input-wrapper">
                                <label for="bezetten" class="sr-only">Bezetten oppervlakte in m²</label>
                                <input type="text" id="bezetten" 
                                       inputmode="decimal"
                                       placeholder="Bezetten oppervlakte (m²)"
                                       data-field="bezetten"
                                       autocomplete="off"
                                       enterkeyhint="go">
                                <span class="unit-inside" aria-hidden="true">m²</span>
                                <span class="label-inside" aria-hidden="true">bezetten oppervlakte</span>
                            </div>
                        </div>
                        <div class="breakdown" id="breakdown-bezetten">
                            <div class="breakdown-row">
                                <span>Materiaal:</span>
                                <span id="mat-bezetten">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Arbeid:</span>
                                <span id="arb-bezetten">€ 0</span>
                            </div>
                            <div class="breakdown-row">
                                <span>Tijd:</span>
                                <span id="tijd-bezetten">0u 0m</span>
                            </div>
                            <div class="breakdown-row total">
                                <span>Totaal:</span>
                                <span id="tot-bezetten">€ 0</span>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <!-- Bijkomend werk sectie -->
            <div class="extra-section">
                <button type="button" class="section-header" id="bijkomend-header"
                        aria-expanded="false" aria-controls="bijkomend-content">
                    <span class="section-toggle" aria-hidden="true"></span>
                    Bijkomend werk
                </button>
                <div class="section-content" id="bijkomend-content">
                    <div class="components-grid">
                        
                        <!-- Hoekprofielen -->
                        <section class="component-card dormant" id="card-hoekprofielen" 
                                 aria-labelledby="title-hoekprofielen">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('hoekprofielen')" 
                                    aria-label="Info hoekprofielen">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-hoekprofielen">Hoekprofiel(en)</h2>
                                    <span class="price-badge" id="price-hoekprofielen">€ 0,00/m</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper">
                                        <label for="hoekprofielen" class="sr-only">
                                            Hoekprofielen lengte in m</label>
                                        <input type="text" id="hoekprofielen" 
                                               inputmode="decimal"
                                               placeholder="Hoekprofielen lengte (m)"
                                               data-field="hoekprofielen"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m</span>
                                        <span class="label-inside" aria-hidden="true">hoekprofielen lengte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-hoekprofielen">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-hoekprofielen">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-hoekprofielen">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-hoekprofielen">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-hoekprofielen">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Bijkomend pleisterwerk -->
                        <section class="component-card dormant" id="card-bijkomendpleister" 
                                 aria-labelledby="title-bijkomendpleister">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('bijkomendpleister')" 
                                    aria-label="Info bijkomend pleisterwerk">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-bijkomendpleister">
                                        Bijkomend pleisterwerk</h2>
                                    <span class="price-badge" id="price-bijkomendpleister">
                                        EUR 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper">
                                        <label for="bijkomendpleister" class="sr-only">
                                            Bijkomend pleisterwerk zakken</label>
                                        <input type="text" id="bijkomendpleister" 
                                               inputmode="decimal"
                                               placeholder="Bijkomend pleisterwerk (zakken 25kg)"
                                               data-field="bijkomendpleister"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">zakken</span>
                                        <span class="label-inside" aria-hidden="true">bijkomend pleisterwerk</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-bijkomendpleister">
                                    <div class="breakdown-row">
                                        <span>Totale dikte:</span>
                                        <span id="totale-dikte-bijkomendpleister">0 cm</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Extra dikte:</span>
                                        <span id="extra-dikte-bijkomendpleister">0 cm</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-bijkomendpleister">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Egalisatie -->
                        <section class="component-card dormant" id="card-egalisatie" 
                                 aria-labelledby="title-egalisatie">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('egalisatie')" 
                                    aria-label="Info egalisatie">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-egalisatie">
                                        Bijkomende egalisatie</h2>
                                    <span class="price-badge" id="price-egalisatie">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper">
                                        <label for="egalisatie" class="sr-only">
                                            Egalisatie zakken Mixemsub</label>
                                        <input type="text" id="egalisatie" 
                                               inputmode="decimal"
                                               placeholder="Egalisatie (zakken Mixemsub)"
                                               data-field="egalisatie"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">zakken</span>
                                        <span class="label-inside" aria-hidden="true">egalisatie</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-egalisatie">
                                    <div class="breakdown-row">
                                        <span>Totale dikte:</span>
                                        <span id="totale-dikte-egalisatie">0 mm</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-egalisatie">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>

            <!-- Extra componenten sectie -->
            <div class="extra-section">
                <button type="button" class="section-header" id="extra-header"
                        aria-expanded="false" aria-controls="extra-content">
                    <span class="section-toggle" aria-hidden="true"></span>
                    Extra componenten
                </button>
                <div class="section-content" id="extra-content">
                    <div class="components-grid">
                        
                        <!-- Grondering Muur -->
                        <section class="component-card dormant" id="card-grondering" 
                                 aria-labelledby="title-grondering">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('grondering')" 
                                    aria-label="Info Grondering">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-grondering">Grondering Muur</h2>
                                    <span class="price-badge" id="price-grondering">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper select-wrapper">
                                        <label for="product-grondering" class="sr-only">Selecteer gronderingsproduct</label>
                                        <select id="product-grondering" data-field="product_grondering" class="placeholder-active">
                                            <option value="" disabled selected>Gronderingsproduct</option>
                                            <option value="betocontact">Knauf, Betokontakt</option>
                                            <option value="stucprimer">Knauf, Stuc Primer</option>
                                            <option value="keisol_mb">Remmers, Keisol MB</option>
                                            <option value="sopro_gd749">Sopro, GD749</option>
                                            <option value="technicure_as">Technichem, Technicure AS</option>
                                            <option value="technicure_cs">Technichem, Technicure CS</option>
                                        </select>
                                    </div>
                                    <div class="input-wrapper">
                                        <label for="grondering" class="sr-only">Grondering oppervlakte in m²</label>
                                        <input type="text" id="grondering" 
                                               inputmode="decimal"
                                               placeholder="Grondering oppervlakte (m²)"
                                               data-field="grondering"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m²</span>
                                        <span class="label-inside" aria-hidden="true">grondering oppervlakte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-grondering">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-grondering">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-grondering">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-grondering">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-grondering">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Fix & Finish -->
                        <section class="component-card dormant" id="card-fixfinish" 
                                 aria-labelledby="title-fixfinish">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('fixfinish')" 
                                    aria-label="Info Fix Finish">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-fixfinish">Fix & Finish</h2>
                                    <span class="price-badge" id="price-fixfinish">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper">
                                        <label for="fixfinish" class="sr-only">
                                            Fix & Finish oppervlakte in m²</label>
                                        <input type="text" id="fixfinish" 
                                               inputmode="decimal"
                                               placeholder="Fix & Finish oppervlakte (m²)"
                                               data-field="fixfinish"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m²</span>
                                        <span class="label-inside" aria-hidden="true">fix & finish oppervlakte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-fixfinish">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-fixfinish">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-fixfinish">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-fixfinish">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-fixfinish">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- XPS isolatie -->
                        <section class="component-card dormant" id="card-xps" 
                                 aria-labelledby="title-xps">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('xps')" aria-label="Info XPS">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-xps">XPS-isolatie</h2>
                                    <span class="price-badge" id="price-xps">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper select-wrapper">
                                        <label for="xps-dikte" class="sr-only">Selecteer dikte XPS plaat</label>
                                        <select id="xps-dikte" data-field="dikte_xps" class="placeholder-active">
                                            <option value="" disabled selected>Dikte XPS plaat (mm)</option>
                                            <option value="20">20</option>
                                            <option value="30">30</option>
                                            <option value="40">40</option>
                                            <option value="50">50</option>
                                            <option value="60">60</option>
                                        </select>
                                        <span class="unit-inside" aria-hidden="true">mm</span>
                                        <span class="label-inside" aria-hidden="true">dikte xps plaat</span>
                                    </div>
                                    <div class="input-wrapper">
                                        <label for="xps" class="sr-only">XPS isolatie oppervlakte in m²</label>
                                        <input type="text" id="xps" 
                                               inputmode="decimal"
                                               placeholder="XPS isolatie oppervlakte (m²)"
                                               data-field="xps"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m²</span>
                                        <span class="label-inside" aria-hidden="true">xps isolatie oppervlakte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-xps">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-xps">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-xps">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-xps">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-xps">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>


                        <!-- Wedi Bouwplatensysteem -->
                        <section class="component-card dormant" id="card-wedi" 
                                 aria-labelledby="title-wedi">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('wedi')" aria-label="Info Wedi">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-wedi">Wedi Bouwplatensysteem</h2>
                                    <span class="price-badge" id="price-wedi">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper select-wrapper">
                                        <label for="wedi-dikte" class="sr-only">Dikte Wedi plaat</label>
                                        <select id="wedi-dikte" data-field="dikte_wedi" class="placeholder-active">
                                            <option value="" disabled selected>Dikte Wedi plaat (mm)</option>
                                            <option value="4">4</option>
                                            <option value="6">6</option>
                                            <option value="10">10</option>
                                        </select>
                                        <span class="unit-inside" aria-hidden="true">mm</span>
                                        <span class="label-inside" aria-hidden="true">dikte wedi plaat</span>
                                    </div>
                                    <div class="input-wrapper select-wrapper">
                                        <label for="wedi-gitex" class="sr-only">Gitex afwerking methode</label>
                                        <select id="wedi-gitex" data-field="gitex_wedi">
                                            <option value="naden" selected>Naden verstevigen met Gitex</option>
                                            <option value="volledig">Volledig oppervlak met Gitex</option>
                                        </select>
                                    </div>
                                    <div class="input-wrapper">
                                        <label for="wedi" class="sr-only">Wedi oppervlakte in m²</label>
                                        <input type="text" id="wedi" 
                                               inputmode="decimal"
                                               placeholder="Wedi bouwplaten oppervlakte (m²)"
                                               data-field="wedi"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m²</span>
                                        <span class="label-inside" aria-hidden="true">wedi oppervlakte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-wedi">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-wedi">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-wedi">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-wedi">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-wedi">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Fassa Shield -->
                        <section class="component-card dormant" id="card-fassashield" 
                                 aria-labelledby="title-fassashield">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('fassashield')" 
                                    aria-label="Info Fassa Shield">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-fassashield">Fassa Shield</h2>
                                    <span class="price-badge" id="price-fassashield">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper">
                                        <label for="fassashield" class="sr-only">
                                            Fassa Shield oppervlakte in m²</label>
                                        <input type="text" id="fassashield" 
                                               inputmode="decimal"
                                               placeholder="Fassa Shield oppervlakte (m²)"
                                               data-field="fassashield"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m²</span>
                                        <span class="label-inside" aria-hidden="true">fassa shield oppervlakte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-fassashield">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-fassashield">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-fassashield">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-fassashield">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-fassashield">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Compacte dichting -->
                        <section class="component-card dormant" id="card-ultradun" 
                                 aria-labelledby="title-ultradun">
                            <button type="button" class="info-btn" tabindex="-1"
                                    onclick="showInfo('ultradun')" 
                                    aria-label="Info compacte dichting">i</button>
                            <div class="card-content">
                                <div class="card-header">
                                    <h2 class="card-title" id="title-ultradun">Compacte dichting</h2>
                                    <span class="price-badge" id="price-ultradun">€ 0,00/m²</span>
                                </div>
                                <div class="input-stack">
                                    <div class="input-wrapper select-wrapper">
                                        <label for="ultradun-systeem" class="sr-only">Selecteer waterdichtingssysteem</label>
                                        <select id="ultradun-systeem" data-field="systeem_ultradun" class="placeholder-active">
                                            <option value="" disabled selected>Waterdichtingssysteem</option>
                                            <option value="asocret">Asocret-M30 systeem</option>
                                            <option value="sopro">Sopro systeem</option>
                                            <option value="sulfatex">Sulfatex systeem</option>
                                        </select>
                                    </div>
                                    <!-- V9.10: Autex dropdown TUSSEN systeem en sopro-lagen -->
                                    <div class="input-wrapper select-wrapper" id="asocret-autex-wrapper" style="display: none;">
                                        <label for="asocret-autex" class="sr-only">Autex glasvezelwapening</label>
                                        <select id="asocret-autex" data-field="autex_asocret">
                                            <option value="zonder" selected>Zonder Autex glasvezelwapening</option>
                                            <option value="met">Met Autex glasvezelwapening</option>
                                        </select>
                                    </div>
                                    <div class="input-wrapper select-wrapper" id="sopro-lagen-wrapper" style="display: none;">
                                        <label for="sopro-lagen" class="sr-only">Aantal lagen Sopro</label>
                                        <select id="sopro-lagen" data-field="lagen_sopro">
                                            <option value="2" selected>2 lagen</option>
                                            <option value="3">3 lagen</option>
                                            <option value="4">4 lagen</option>
                                        </select>
                                    </div>
                                    <div class="input-wrapper">
                                        <label for="ultradun" class="sr-only">
                                            Waterdichting oppervlakte in m²</label>
                                        <input type="text" id="ultradun" 
                                               inputmode="decimal"
                                               placeholder="Waterdichting oppervlakte (m²)"
                                               data-field="ultradun"
                                               autocomplete="off">
                                        <span class="unit-inside" aria-hidden="true">m²</span>
                                        <span class="label-inside" aria-hidden="true">waterdichting oppervlakte</span>
                                    </div>
                                </div>
                                <div class="breakdown" id="breakdown-ultradun">
                                    <div class="breakdown-row">
                                        <span>Materiaal:</span>
                                        <span id="mat-ultradun">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Arbeid:</span>
                                        <span id="arb-ultradun">€ 0</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Tijd:</span>
                                        <span id="tijd-ultradun">0u 0m</span>
                                    </div>
                                    <div class="breakdown-row total">
                                        <span>Totaal:</span>
                                        <span id="tot-ultradun">€ 0</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>

            <!-- Summary Card -->
            <aside class="summary-card dormant" id="summary" aria-label="Totaaloverzicht">
                <h2 class="summary-title">Totaaloverzicht</h2>
                
                <div class="summary-section-title" id="hoofdcomponenten-title">Hoofdcomponenten</div>
                
                <div class="summary-row">
                    <span>Tijd:</span>
                    <span id="total-tijd">0u 0m</span>
                </div>
                <div class="summary-row">
                    <span>Arbeid:</span>
                    <span id="total-arbeid">€ 0,00</span>
                </div>
                <div class="summary-row">
                    <span>Materiaal:</span>
                    <span id="total-materiaal">€ 0,00</span>
                </div>
                <div class="summary-row">
                    <span>T&O:</span>
                    <span id="total-to">€ 0,00</span>
                </div>
                
                <div class="summary-section-title" id="bijkomend-title" style="display: none;">
                    Bijkomend werk</div>
                
                <div class="summary-row indented" id="row-hoekprofielen" style="display: none;">
                    <span>Hoekprofielen:</span>
                    <span id="total-hoekprofielen">€ 0,00</span>
                </div>
                <div class="summary-row indented" id="row-bijkomendpleister" style="display: none;">
                    <span>Bijkomend pleister:</span>
                    <span id="total-bijkomendpleister">€ 0,00</span>
                </div>
                <div class="summary-row indented" id="row-egalisatie" style="display: none;">
                    <span>Egalisatie:</span>
                    <span id="total-egalisatie">€ 0,00</span>
                </div>
                
                <div class="summary-divider"></div>
                
                <div class="summary-row">
                    <span>Marge (25%):</span>
                    <span id="total-winst">€ 0,00</span>
                </div>
                
                <div class="summary-total">
                    <span class="value" id="total-prijs">€ 0,00</span>
                </div>
            </aside>

            <!-- Invoice Overview -->
            <aside class="invoice-card dormant" id="invoice" aria-label="Factuuroverzicht">
                <h2 class="invoice-title">Factuuroverzicht</h2>
                <div id="invoice-items">
                    <!-- Dynamisch gevuld -->
                </div>
                <div class="invoice-total" id="invoice-total">€ 0,00</div>
            </aside>

            <div class="summary-footer">© 2025 Vecon</div>

        </main>
    </div>

    <!-- Info Modal - V30.13 Styling -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
        <div class="info-modal" id="infoModal" role="dialog" aria-modal="true">
            <div class="modal-header">
                <h4 class="modal-title" id="modal-title">Component Info</h4>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamisch gevuld -->
            </div>
            <button type="button" class="modal-close" onclick="closeModal()">Sluiten</button>
        </div>
    </div>

    <script>
    /* ============================================================
       JAVASCRIPT - AQP SUBCALCULATOR V8.0
       ============================================================ */

    // === CONSTANTEN ===
    const LOON = 48.03;
    const TO_PER_DAG = 208;

    // Hoofdcomponenten configuratie
    const COMP = {
        afkappen: { cap_per_man: 35, mat: 0 },
        injecties: { cap_per_man: 60, mat: 3.16 },  // V9.24: Fassa Inject alleen
        membraan: { cap_per_man: 40, mat: 8.20 },   // V9.26: CODEX + SNC KB
        bezetten: { cap_per_man: 20, mat: 5.70 }
    };

    // Extra componenten configuratie
    const XTRA = {
        xps: { cap_per_man: 30 },  // V7.0: aangepast van 20 naar 30
        wedi: { cap_per_man: 25 },  // V8.0: Wedi Bouwplatensysteem
        ultradun: {
            sulfatex: { cap_per_man: 30, mat: 5.50 },
            sopro: { 
                mat_per_laag: 3.75,  // V9.29: 1,2 kg/m2/mm x € 3,125/kg = € 3,75/laag
                // Capaciteit en materiaal per aantal lagen (basis 32,5 m2/dag)
                lagen: {
                    2: { cap_per_man: 32.50, mat: 7.50 },
                    3: { cap_per_man: 21.67, mat: 11.25 },
                    4: { cap_per_man: 16.25, mat: 15.00 }
                }
            },
            // V9.1: Asocret-M30 waterdichte multimortel (Schomburg)
            asocret: {
                cap_zonder_autex: 30,       // 30 m2/dag zonder Autex
                cap_met_autex: 25,          // 25 m2/dag met Autex
                mat_zonder_autex: 16.20,    // EUR 16,20/m2 (14 kg x € 1,157/kg)
                mat_met_autex: 18.36,       // EUR 18,36/m2 (incl. Autex EUR 2,16)
                naam: "Schomburg, Asocret-M30",
                verbruik: "14 kg/m² (10mm)",
                laagdikte: 10
            }
        },
        fixfinish: { cap_per_man: 35, mat: 2.40 },  // V9.29: 4 kg/m² x € 0,60/kg
        fassashield: { cap_per_man: 15, mat: 40.28 },
        // V8.8: Grondering Muur - 6 producten
        grondering: {
            stucprimer:    { cap_per_man: 140, mat: 0.70, naam: "Knauf, Stuc Primer", verbruik: "0,14 kg/m²" },
            sopro_gd749:   { cap_per_man: 140, mat: 1.17, naam: "Sopro, GD749", verbruik: "0,15 kg/m²" },
            technicure_cs: { cap_per_man: 140, mat: 2.91, naam: "Technichem, Technicure CS", verbruik: "0,40 L/m²" },
            keisol_mb:     { cap_per_man: 140, mat: 3.10, naam: "Remmers, Keisol MB", verbruik: "0,60 L/m²" },
            betocontact:   { cap_per_man: 120, mat: 1.73, naam: "Knauf, Betokontakt", verbruik: "0,25 kg/m²" },
            technicure_as: { 
                cap_per_man: 120, 
                emmer_kg: 5,
                emmer_prijs: 51.918,
                verbruik_per_m2: 0.33,
                naam: "Technichem, Technicure AS",
                verbruik: "0,33 kg/m² (2 lagen)",
                trapfunctie: true
            }
        }
    };

    // XPS materiaalkosten per dikte
    const XPS_MAT = {
        20: 6.00,
        30: 7.50,
        40: 9.00,
        50: 10.50,
        60: 12.00
    };

    // V9.21: Wedi gitex systemen (naden vs volledig)
    const WEDI_GITEX_SYSTEMS = {
        naden: {
            naam: 'Naden verstevigen',
            productiviteit: 30,           // m2/dag per man
            gitex_verbruik: 0.12,         // m2 Gitex per m2 wand
            gitex_prijs: 0.42,            // 0.12 x 3.50
            snelband_verbruik: 0.29,      // kg/m2 (alleen naden, ~12% van volledig)
            snelband_prijs: 0.16          // 0.29 x 0.56
        },
        volledig: {
            naam: 'Volledig oppervlak',
            productiviteit: 25,           // m2/dag per man
            gitex_verbruik: 1.10,         // m2 Gitex per m2 wand
            gitex_prijs: 3.85,            // 1.10 x 3.50
            snelband_verbruik: 2.40,      // kg/m2 (volledig oppervlak)
            snelband_prijs: 1.34          // 2.40 x 0.56
        }
    };

    // Wedi materiaalkosten per dikte (plaat + flexlijm)
    // V9.21: Gitex en Snelband apart via WEDI_GITEX_SYSTEMS
    // Bron: WEDI_BOUWPLATEN_KNOWLEDGE_BASE_V1_4.md + V30.18
    const WEDI_MAT_BREAKDOWN = {
        4: {
            plaat:    { naam: 'Wedi plaat 4mm', prijs: 31.42, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '29,92' },
            flexlijm: { naam: 'Flexlijm C2 TE', prijs: 5.00,  
                        verbruik: '6,25 kg/m²', eenheidsprijs: '0,80/kg' }
        },
        6: {
            plaat:    { naam: 'Wedi plaat 6mm', prijs: 28.98, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '27,60' },
            flexlijm: { naam: 'Flexlijm C2 TE', prijs: 5.00,  
                        verbruik: '6,25 kg/m²', eenheidsprijs: '0,80/kg' }
        },
        10: {
            plaat:    { naam: 'Wedi plaat 10mm', prijs: 27.81, 
                        verbruik: '1,05 m2/m²',  eenheidsprijs: '26,49' },
            flexlijm: { naam: 'Flexlijm C2 TE',  prijs: 5.00,  
                        verbruik: '6,25 kg/m²',  eenheidsprijs: '0,80/kg' }
        }
    };
    
    // V9.16: Session state voor materiaal checkboxes (alle aan by default)
    const materialState = {
        wedi: {
            plaat: true,
            flexlijm: true,
            gitex: true,
            snelband: true
        },
        // V9.22: Uitgebreid voor alle componenten
        // V9.24: Injecties alleen Fassa Inject (zonder PU-schuim)
        injecties: {
            fassainject: true
        },
        // V9.26: Membraan met CODEX POWER + SNC-Membraan
        membraan: {
            codex: true,
            snc: true
        },
        bezetten: {
            mp75: true
        },
        // V9.27: XPS zonder PU-schuim
        xps: {
            plaat: true,
            lgips: true,
            gitex: true,
            snelband: true
        },
        // V9.29: Sopro alleen mortel
        sopro: {
            mortel: true
        },
        asocret: {
            mortel: true,
            autex: true
        },
        fixfinish: {
            absfinish: true
        },
        fassashield: {
            shield: true,
            superbond: true,
            afwerking: true
        },
        // V9.28: Bijkomend pleisterwerk puur MP75
        bijkomendpleister: {
            mp75: true
        }
    };
    
    // V9.24: Material breakdown voor Injecties (alleen Fassa Inject)
    const INJECTIES_MAT_BREAKDOWN = {
        fassainject: { naam: 'Fassa Inject', prijs: 3.16, 
                       verbruik: '0,2 L/m', eenheidsprijs: '15,80/L' }
    };
    
    // V9.26: Material breakdown voor Membraan (Hygroscopische KB)
    const MEMBRAAN_MAT_BREAKDOWN = {
        codex: { naam: 'CODEX POWER CX2', prijs: 3.77, 
                 verbruik: '6,25 kg/m²', eenheidsprijs: '0,60/kg' },
        snc:   { naam: 'SNC-Membraan', prijs: 4.43, 
                 verbruik: '1,10 m2/m²', eenheidsprijs: '4,03/m²' }
    };
    
    // V9.22: Material breakdown voor Bezetten
    const BEZETTEN_MAT_BREAKDOWN = {
        mp75: { naam: 'MP75 gipspleister', prijs: 5.70, 
                verbruik: '15 kg/m²', eenheidsprijs: '0,38/kg' }
    };
    
    // V9.22: Material breakdown voor XPS per dikte
    // V9.27: XPS Material breakdown zonder PU-schuim
    const XPS_MAT_BREAKDOWN = {
        20: {
            plaat:    { naam: 'XPS plaat 20mm', prijs: 3.15, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '3,00' },
            lgips:    { naam: 'L-gips (punt)', prijs: 2.40, 
                        verbruik: 'punt-systeem', eenheidsprijs: 'forfait' },
            gitex:    { naam: 'Gitex weefsel', prijs: 1.43, 
                        verbruik: '1,1 m2/m²', eenheidsprijs: '1,30/m²' },
            snelband: { naam: 'Snelband 3mm', prijs: 1.34, 
                        verbruik: '2,4 kg/m²', eenheidsprijs: '0,56/kg' }
        },
        30: {
            plaat:    { naam: 'XPS plaat 30mm', prijs: 3.83, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '3,65' },
            lgips:    { naam: 'L-gips (punt)', prijs: 2.40, 
                        verbruik: 'punt-systeem', eenheidsprijs: 'forfait' },
            gitex:    { naam: 'Gitex weefsel', prijs: 1.43, 
                        verbruik: '1,1 m2/m²', eenheidsprijs: '1,30/m²' },
            snelband: { naam: 'Snelband 3mm', prijs: 1.34, 
                        verbruik: '2,4 kg/m²', eenheidsprijs: '0,56/kg' }
        },
        40: {
            plaat:    { naam: 'XPS plaat 40mm', prijs: 5.25, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '5,00' },
            lgips:    { naam: 'L-gips (punt)', prijs: 2.40, 
                        verbruik: 'punt-systeem', eenheidsprijs: 'forfait' },
            gitex:    { naam: 'Gitex weefsel', prijs: 1.43, 
                        verbruik: '1,1 m2/m²', eenheidsprijs: '1,30/m²' },
            snelband: { naam: 'Snelband 3mm', prijs: 1.34, 
                        verbruik: '2,4 kg/m²', eenheidsprijs: '0,56/kg' }
        },
        50: {
            plaat:    { naam: 'XPS plaat 50mm', prijs: 6.56, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '6,25' },
            lgips:    { naam: 'L-gips (punt)', prijs: 2.40, 
                        verbruik: 'punt-systeem', eenheidsprijs: 'forfait' },
            gitex:    { naam: 'Gitex weefsel', prijs: 1.43, 
                        verbruik: '1,1 m2/m²', eenheidsprijs: '1,30/m²' },
            snelband: { naam: 'Snelband 3mm', prijs: 1.34, 
                        verbruik: '2,4 kg/m²', eenheidsprijs: '0,56/kg' }
        },
        60: {
            plaat:    { naam: 'XPS plaat 60mm', prijs: 7.88, 
                        verbruik: '1,05 m2/m²', eenheidsprijs: '7,50' },
            lgips:    { naam: 'L-gips (punt)', prijs: 2.40, 
                        verbruik: 'punt-systeem', eenheidsprijs: 'forfait' },
            gitex:    { naam: 'Gitex weefsel', prijs: 1.43, 
                        verbruik: '1,1 m2/m²', eenheidsprijs: '1,30/m²' },
            snelband: { naam: 'Snelband 3mm', prijs: 1.34, 
                        verbruik: '2,4 kg/m²', eenheidsprijs: '0,56/kg' }
        }
    };
    
    // V9.22: Material breakdown voor Sopro Ultradun per aantal lagen
    // V9.29: Sopro alleen mortel (wapening verwijderd)
    // 1,2 kg/m2 per mm droge laagdikte x € 3,125/kg (EUR 75/24kg)
    const SOPRO_MAT_BREAKDOWN = {
        2: {
            mortel:   { naam: 'Sopro ZR Turbo (2 lagen)', prijs: 7.50, 
                        verbruik: '2,4 kg/m²', eenheidsprijs: '3,125/kg' }
        },
        3: {
            mortel:   { naam: 'Sopro ZR Turbo (3 lagen)', prijs: 11.25, 
                        verbruik: '3,6 kg/m²', eenheidsprijs: '3,125/kg' }
        },
        4: {
            mortel:   { naam: 'Sopro ZR Turbo (4 lagen)', prijs: 15.00, 
                        verbruik: '4,8 kg/m²', eenheidsprijs: '3,125/kg' }
        }
    };
    
    // V9.22: Material breakdown voor Asocret
    const ASOCRET_MAT_BREAKDOWN = {
        mortel: { naam: 'Asocret-M30', prijs: 16.20, 
                  verbruik: '14 kg/m²', eenheidsprijs: '1,157/kg' },
        autex:  { naam: 'Autex glasvezelwapening', prijs: 2.16, 
                  verbruik: '1,1 m2/m²', eenheidsprijs: '1,96/m²' }
    };
    
    // V9.29: Material breakdown voor Fix & Finish (4 kg/m² x € 0,60/kg)
    const FIXFINISH_MAT_BREAKDOWN = {
        absfinish: { naam: 'Fix & Finish', prijs: 2.40, 
                     verbruik: '4 kg/m²', eenheidsprijs: '0,60/kg' }
    };
    
    // V9.22: Material breakdown voor Fassa Shield
    const FASSASHIELD_MAT_BREAKDOWN = {
        shield:    { naam: 'Fassa Shield', prijs: 33.89, 
                     verbruik: '25 kg/m²', eenheidsprijs: '1,36/kg' },
        superbond: { naam: 'Superbond', prijs: 4.27, 
                     verbruik: '5 kg/m²', eenheidsprijs: '0,85/kg' },
        afwerking: { naam: 'Fix & Finish afwerking', prijs: 2.12, 
                     verbruik: '1,8 kg/m²', eenheidsprijs: '1,18/kg' }
    };
    
    // V9.28: Bijkomend pleisterwerk - puur MP75
    const BIJKOMENDPLEISTER_MAT_BREAKDOWN = {
        mp75: { naam: 'Knauf MP75', prijs: 2.85, 
                verbruik: '7,5 kg/cm/m²', eenheidsprijs: '0,38/kg' }
    };
    const BIJKOMENDPLEISTER_ARBEID = 7.15;  // EUR/cm/m² vast
    
    // V9.24: Effectieve materiaalprijs functies per component
    function getInjectiesMatPrijs() {
        let totaal = 0;
        if (materialState.injecties.fassainject) totaal += INJECTIES_MAT_BREAKDOWN.fassainject.prijs;
        return totaal;
    }
    
    // V9.26: Membraan met twee materialen
    function getMembraanMatPrijs() {
        let totaal = 0;
        if (materialState.membraan.codex) totaal += MEMBRAAN_MAT_BREAKDOWN.codex.prijs;
        if (materialState.membraan.snc) totaal += MEMBRAAN_MAT_BREAKDOWN.snc.prijs;
        return totaal;
    }
    
    function getBezettenMatPrijs() {
        let totaal = 0;
        if (materialState.bezetten.mp75) totaal += BEZETTEN_MAT_BREAKDOWN.mp75.prijs;
        return totaal;
    }
    
    // V9.27: XPS zonder PU-schuim
    function getXpsMatPrijs(dikte) {
        const breakdown = XPS_MAT_BREAKDOWN[dikte] || XPS_MAT_BREAKDOWN[40];
        let totaal = 0;
        if (materialState.xps.plaat) totaal += breakdown.plaat.prijs;
        if (materialState.xps.lgips) totaal += breakdown.lgips.prijs;
        if (materialState.xps.gitex) totaal += breakdown.gitex.prijs;
        if (materialState.xps.snelband) totaal += breakdown.snelband.prijs;
        return totaal;
    }
    
    // V9.29: Sopro alleen mortel
    function getSoproMatPrijs(lagen) {
        const breakdown = SOPRO_MAT_BREAKDOWN[lagen] || SOPRO_MAT_BREAKDOWN[2];
        let totaal = 0;
        if (materialState.sopro.mortel) totaal += breakdown.mortel.prijs;
        return totaal;
    }
    
    function getAsocretMatPrijs(metAutex) {
        let totaal = 0;
        if (materialState.asocret.mortel) totaal += ASOCRET_MAT_BREAKDOWN.mortel.prijs;
        if (metAutex && materialState.asocret.autex) totaal += ASOCRET_MAT_BREAKDOWN.autex.prijs;
        return totaal;
    }
    
    function getFixfinishMatPrijs() {
        let totaal = 0;
        if (materialState.fixfinish.absfinish) totaal += FIXFINISH_MAT_BREAKDOWN.absfinish.prijs;
        return totaal;
    }
    
    function getFassashieldMatPrijs() {
        let totaal = 0;
        if (materialState.fassashield.shield) totaal += FASSASHIELD_MAT_BREAKDOWN.shield.prijs;
        if (materialState.fassashield.superbond) totaal += FASSASHIELD_MAT_BREAKDOWN.superbond.prijs;
        if (materialState.fassashield.afwerking) totaal += FASSASHIELD_MAT_BREAKDOWN.afwerking.prijs;
        return totaal;
    }
    
    // V9.28: Bijkomend pleisterwerk materiaalprijs (per cm/m2)
    function getBijkomendpleisterMatPrijs() {
        let totaal = 0;
        if (materialState.bijkomendpleister.mp75) totaal += BIJKOMENDPLEISTER_MAT_BREAKDOWN.mp75.prijs;
        return totaal;
    }
    
    // V9.21: Bereken effectieve Wedi materiaalprijs op basis van checkbox state + gitex methode
    function getWediMatPrijs(dikte, gitexMethode) {
        const breakdown = WEDI_MAT_BREAKDOWN[dikte] || WEDI_MAT_BREAKDOWN[10];
        const gitexSys = WEDI_GITEX_SYSTEMS[gitexMethode] || WEDI_GITEX_SYSTEMS.naden;
        let totaal = 0;
        
        // Plaat
        if (materialState.wedi.plaat) {
            totaal += breakdown.plaat.prijs;
        }
        // Flexlijm
        if (materialState.wedi.flexlijm) {
            totaal += breakdown.flexlijm.prijs;
        }
        // Gitex (variabel per methode)
        if (materialState.wedi.gitex) {
            totaal += gitexSys.gitex_prijs;
        }
        // Snelband (variabel per methode)
        if (materialState.wedi.snelband) {
            totaal += gitexSys.snelband_prijs;
        }
        
        return totaal;
    }
    
    // V9.21: Haal Wedi capaciteit op basis van gitex methode
    function getWediCapaciteit(gitexMethode) {
        const gitexSys = WEDI_GITEX_SYSTEMS[gitexMethode] || WEDI_GITEX_SYSTEMS.naden;
        return gitexSys.productiviteit;
    }
    
    // Legacy WEDI_MAT voor backward compatibility (niet meer direct gebruikt)
    // V9.21: Naden is standaard - totalen voor naden methode
    const WEDI_MAT = {
        4:  37.00,    // 31.42 + 5.00 + 0.42 + 0.16 (naden)
        6:  34.56,    // 28.98 + 5.00 + 0.42 + 0.16 (naden)
        10: 33.39     // 27.81 + 5.00 + 0.42 + 0.16 (naden)
    };

    // === THEME MANAGEMENT ===
    const themeBtn = document.getElementById('theme-toggle-btn');
    const body = document.body;

    // ============================================================
    // UNITPOSITIONER - V3.0 Label Positioning
    // Dynamically positions unit and label after typed value
    // ============================================================
    
    const UnitPositioner = (() => {
        const update = (element) => {
            const wrapper = element.parentElement;
            if (!wrapper || !wrapper.classList.contains('input-wrapper')) return;
            
            const unit = wrapper.querySelector('.unit-inside');
            const label = wrapper.querySelector('.label-inside');
            if (!unit) return;
            
            const isSelect = element.tagName === 'SELECT';
            const value = isSelect ? element.options[element.selectedIndex].text : element.value;
            
            // Check for empty/placeholder state
            if ((isSelect && (element.value === '' || element.classList.contains('placeholder-active'))) || 
                (!isSelect && !value)) {
                // Reset to default position when empty
                unit.style.left = '13px';
                if (label) label.style.left = '13px';
                return;
            }
            
            // Measure text width
            const temp = document.createElement('span');
            temp.style.cssText = 'visibility:hidden;position:absolute;white-space:nowrap;';
            temp.style.font = window.getComputedStyle(element).font;
            temp.style.fontSize = window.getComputedStyle(element).fontSize;
            temp.textContent = value;
            document.body.appendChild(temp);
            const textWidth = temp.offsetWidth;
            document.body.removeChild(temp);
            
            // Position unit after value
            const unitLeft = 13 + textWidth + 5;
            unit.style.left = unitLeft + 'px';
            
            // Position label after unit
            if (label) {
                const tempUnit = document.createElement('span');
                tempUnit.style.cssText = 'visibility:hidden;position:absolute;white-space:nowrap;';
                tempUnit.style.font = window.getComputedStyle(unit).font;
                tempUnit.style.fontSize = window.getComputedStyle(unit).fontSize;
                tempUnit.textContent = unit.textContent;
                document.body.appendChild(tempUnit);
                const unitWidth = tempUnit.offsetWidth;
                document.body.removeChild(tempUnit);
                label.style.left = (unitLeft + unitWidth + 8) + 'px';
            }
        };
        
        const init = () => {
            // Observe all inputs and selects for resize changes
            if (typeof ResizeObserver !== 'undefined') {
                const observer = new ResizeObserver(entries => {
                    entries.forEach(entry => {
                        const isSelect = entry.target.tagName === 'SELECT';
                        if ((isSelect && entry.target.value) || (!isSelect && entry.target.value)) {
                            update(entry.target);
                        }
                    });
                });
                document.querySelectorAll('.input-wrapper input, .input-wrapper select').forEach(el => {
                    observer.observe(el);
                });
            }
        };
        
        const reset = () => {
            document.querySelectorAll('.unit-inside, .label-inside').forEach(el => {
                el.style.left = '13px';
            });
        };
        
        return { update, init, reset };
    })();

    function loadTheme() {
        try {
            const saved = localStorage.getItem('aqp-theme');
            if (saved === 'light') {
                body.classList.remove('dark-mode');
            }
        } catch (e) {}
    }

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        try {
            localStorage.setItem('aqp-theme', 
                body.classList.contains('dark-mode') ? 'dark' : 'light');
        } catch (e) {}
    }

    themeBtn.addEventListener('click', toggleTheme);
    loadTheme();

    // === RESET FUNCTION ===
    const resetBtn = document.getElementById('reset-btn');
    
    resetBtn.addEventListener('click', function() {
        this.classList.add('btn-flash');
        
        const inputIds = [
            'afkappen', 'injecties', 'membraan', 'bezetten',
            'hoekprofielen', 'bijkomendpleister', 'egalisatie',
            'xps', 'wedi', 'ultradun', 'fixfinish', 'fassashield', 'grondering'
        ];
        
        inputIds.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = '';
        });
        
        document.getElementById('xps-dikte').selectedIndex = 0;
        document.getElementById('xps-dikte').classList.add('placeholder-active');
        document.getElementById('wedi-dikte').selectedIndex = 0;
        document.getElementById('wedi-dikte').classList.add('placeholder-active');
        document.getElementById('ultradun-systeem').selectedIndex = 0;
        document.getElementById('ultradun-systeem').classList.add('placeholder-active');
        // V8.2: Reset sopro-lagen dropdown to default (2 lagen)
        document.getElementById('sopro-lagen').value = '2';
        document.getElementById('sopro-lagen-wrapper').style.display = 'none';
        // V9.9: Reset asocret-autex dropdown (default: zonder)
        document.getElementById('asocret-autex').value = 'zonder';
        document.getElementById('asocret-autex-wrapper').style.display = 'none';
        // V8.8: Reset product-grondering dropdown
        document.getElementById('product-grondering').selectedIndex = 0;
        document.getElementById('product-grondering').classList.add('placeholder-active');
        
        // Reset unit/label positions
        UnitPositioner.reset();
        
        // Collapse sections
        ['bijkomend', 'extra'].forEach(section => {
            const header = document.getElementById(`${section}-header`);
            const content = document.getElementById(`${section}-content`);
            if (header && content) {
                header.classList.remove('expanded');
                header.setAttribute('aria-expanded', 'false');
                content.classList.remove('show');
            }
        });
        
        calculate();
        
        setTimeout(() => this.classList.remove('btn-flash'), 300);
    });

    // === SECTION TOGGLES ===
    ['bijkomend', 'extra'].forEach(section => {
        const header = document.getElementById(`${section}-header`);
        const content = document.getElementById(`${section}-content`);
        
        header.addEventListener('click', function() {
            const expanded = this.getAttribute('aria-expanded') === 'true';
            this.setAttribute('aria-expanded', !expanded);
            this.classList.toggle('expanded');
            content.classList.toggle('show');
        });
    });

    // === MODAL FUNCTIONS ===
    window.showInfo = function(component) {
        const modal = document.getElementById('infoModal');
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');
        
        const titles = {
            afkappen: 'Afkappen pleister',
            injecties: 'Vochtinjecties',
            membraan: 'SNC-membraan',
            bezetten: 'Bezetten gips',
            hoekprofielen: 'Hoekprofielen',
            bijkomendpleister: 'Bijkomend pleisterwerk',
            egalisatie: 'Bijkomende egalisatie',
            xps: 'XPS-isolatiesysteem',
            wedi: 'Wedi Bouwplatensysteem',
            ultradun: 'Compacte dichting',
            fixfinish: 'Fix & Finish',
            fassashield: 'Fassa Shield Isolatiesysteem'
        };
        
        title.textContent = titles[component] || component;
        
        const qty = parseFloat(document.getElementById(
            component === 'bijkomendpleister' || component === 'egalisatie' 
            ? component : component).value) || 0;
        
        let html = '<div class="info-section">';
        
        if (qty > 0) {
            // === AFKAPPEN (alleen arbeid) ===
            if (component === 'afkappen') {
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Geen materiaalkosten (enkel arbeid)</li>';
                html += '<li>Capaciteit: 35 m²/man/dag</li>';
                html += `<li>${qty} m² = ${(qty / 35 * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
            }
            // === INJECTIES (V9.24 alleen Fassa Inject) ===
            else if (component === 'injecties') {
                const effectief_mat = getInjectiesMatPrijs();
                const breakdown = INJECTIES_MAT_BREAKDOWN;
                
                // Sectie 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Capaciteit: 60 m/man/dag</li>';
                html += `<li>${qty} m = ${(qty / 60 * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
                
                // Sectie 2: Materiaalkosten met checkbox
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                // Fassa Inject
                const fassaChecked = materialState.injecties.fassainject ? 'checked' : '';
                const fassaDisabled = materialState.injecties.fassainject ? '' : 'disabled';
                const fassaPrijs = materialState.injecties.fassainject ? breakdown.fassainject.prijs : 0;
                html += `<li class="material-checkbox-item ${fassaDisabled}" data-key="fassainject">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${fassaChecked} onchange="toggleInjectiesMaterial('fassainject', ${qty})">`;
                html += `<span class="mat-name">${breakdown.fassainject.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${fassaPrijs.toFixed(2)}/m</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.fassainject.verbruik} x € ${breakdown.fassainject.eenheidsprijs}</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="injecties-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === MEMBRAAN (V9.26 CODEX + SNC) ===
            else if (component === 'membraan') {
                const effectief_mat = getMembraanMatPrijs();
                const breakdown = MEMBRAAN_MAT_BREAKDOWN;
                
                // Sectie 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Capaciteit: 40 m²/man/dag</li>';
                html += `<li>${qty} m² = ${(qty / 40 * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
                
                // Sectie 2: Materiaalkosten met checkboxes
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                // CODEX POWER CX2
                const codexChecked = materialState.membraan.codex ? 'checked' : '';
                const codexDisabled = materialState.membraan.codex ? '' : 'disabled';
                const codexPrijs = materialState.membraan.codex ? breakdown.codex.prijs : 0;
                html += `<li class="material-checkbox-item ${codexDisabled}" data-key="codex">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${codexChecked} onchange="toggleMembraanMaterial('codex', ${qty})">`;
                html += `<span class="mat-name">${breakdown.codex.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${codexPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.codex.verbruik} x € ${breakdown.codex.eenheidsprijs}</div>`;
                html += '</li>';
                
                // SNC-Membraan
                const sncChecked = materialState.membraan.snc ? 'checked' : '';
                const sncDisabled = materialState.membraan.snc ? '' : 'disabled';
                const sncPrijs = materialState.membraan.snc ? breakdown.snc.prijs : 0;
                html += `<li class="material-checkbox-item ${sncDisabled}" data-key="snc">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${sncChecked} onchange="toggleMembraanMaterial('snc', ${qty})">`;
                html += `<span class="mat-name">${breakdown.snc.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${sncPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.snc.verbruik} x € ${breakdown.snc.eenheidsprijs}</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="membraan-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === BEZETTEN (V9.22 two-line layout) ===
            else if (component === 'bezetten') {
                const effectief_mat = getBezettenMatPrijs();
                const breakdown = BEZETTEN_MAT_BREAKDOWN;
                
                // Sectie 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Capaciteit: 20 m²/man/dag</li>';
                html += `<li>${qty} m² = ${(qty / 20 * 8).toFixed(2)} manuren</li>`;
                html += `<li>Zakken (25kg): ${(qty * 15 / 25).toFixed(1)} stuks</li>`;
                html += '</ul>';
                
                // Sectie 2: Materiaalkosten met checkbox
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                const mp75Checked = materialState.bezetten.mp75 ? 'checked' : '';
                const mp75Disabled = materialState.bezetten.mp75 ? '' : 'disabled';
                const mp75Prijs = materialState.bezetten.mp75 ? breakdown.mp75.prijs : 0;
                html += `<li class="material-checkbox-item ${mp75Disabled}" data-key="mp75">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${mp75Checked} onchange="toggleBezettenMaterial('mp75', ${qty})">`;
                html += `<span class="mat-name">${breakdown.mp75.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${mp75Prijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.mp75.verbruik} x € ${breakdown.mp75.eenheidsprijs}</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="bezetten-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === XPS (V9.22 two-line layout met 5 checkboxes) ===
            else if (component === 'xps') {
                const dikte = parseInt(document.getElementById('xps-dikte').value) || 40;
                const effectief_mat = getXpsMatPrijs(dikte);
                const breakdown = XPS_MAT_BREAKDOWN[dikte] || XPS_MAT_BREAKDOWN[40];
                
                // Sectie 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Capaciteit: 30 m²/man/dag</li>';
                html += `<li>${qty} m² = ${(qty / 30 * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
                
                // Sectie 2: Materiaalkosten met checkboxes
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                // XPS plaat
                const plaatChecked = materialState.xps.plaat ? 'checked' : '';
                const plaatDisabled = materialState.xps.plaat ? '' : 'disabled';
                const plaatPrijs = materialState.xps.plaat ? breakdown.plaat.prijs : 0;
                html += `<li class="material-checkbox-item ${plaatDisabled}" data-key="plaat">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${plaatChecked} onchange="toggleXpsMaterial('plaat', ${dikte}, ${qty})">`;
                html += `<span class="mat-name">${breakdown.plaat.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${plaatPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.plaat.verbruik} x € ${breakdown.plaat.eenheidsprijs}</div>`;
                html += '</li>';
                
                // L-gips
                const lgipsChecked = materialState.xps.lgips ? 'checked' : '';
                const lgipsDisabled = materialState.xps.lgips ? '' : 'disabled';
                const lgipsPrijs = materialState.xps.lgips ? breakdown.lgips.prijs : 0;
                html += `<li class="material-checkbox-item ${lgipsDisabled}" data-key="lgips">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${lgipsChecked} onchange="toggleXpsMaterial('lgips', ${dikte}, ${qty})">`;
                html += `<span class="mat-name">${breakdown.lgips.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${lgipsPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.lgips.verbruik} x € ${breakdown.lgips.eenheidsprijs}</div>`;
                html += '</li>';
                
                // Gitex weefsel
                const gitexChecked = materialState.xps.gitex ? 'checked' : '';
                const gitexDisabled = materialState.xps.gitex ? '' : 'disabled';
                const gitexPrijs = materialState.xps.gitex ? breakdown.gitex.prijs : 0;
                html += `<li class="material-checkbox-item ${gitexDisabled}" data-key="gitex">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${gitexChecked} onchange="toggleXpsMaterial('gitex', ${dikte}, ${qty})">`;
                html += `<span class="mat-name">${breakdown.gitex.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${gitexPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.gitex.verbruik} x € ${breakdown.gitex.eenheidsprijs}</div>`;
                html += '</li>';
                
                // Snelband
                const snelbandChecked = materialState.xps.snelband ? 'checked' : '';
                const snelbandDisabled = materialState.xps.snelband ? '' : 'disabled';
                const snelbandPrijs = materialState.xps.snelband ? breakdown.snelband.prijs : 0;
                html += `<li class="material-checkbox-item ${snelbandDisabled}" data-key="snelband">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${snelbandChecked} onchange="toggleXpsMaterial('snelband', ${dikte}, ${qty})">`;
                html += `<span class="mat-name">${breakdown.snelband.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${snelbandPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.snelband.verbruik} x € ${breakdown.snelband.eenheidsprijs}</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="xps-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === WEDI (bestaande V9.21 implementatie - referentie) ===
            else if (component === 'wedi') {
                const dikte = parseInt(document.getElementById('wedi-dikte').value) || 10;
                const gitexMethode = document.getElementById('wedi-gitex').value || 'naden';
                const breakdown = WEDI_MAT_BREAKDOWN[dikte] || WEDI_MAT_BREAKDOWN[10];
                const gitexSys = WEDI_GITEX_SYSTEMS[gitexMethode] || WEDI_GITEX_SYSTEMS.naden;
                const effectief_mat = getWediMatPrijs(dikte, gitexMethode);
                const cap_per_man = getWediCapaciteit(gitexMethode);
                
                // Section 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += `<li>Methode: ${gitexSys.naam}</li>`;
                html += `<li>Capaciteit: ${cap_per_man} m²/man/dag</li>`;
                html += `<li>${qty} m² = ${(qty / cap_per_man * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
                
                // Section 2: Materiaalkosten met checkboxes
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                // Plaat
                const plaatChecked = materialState.wedi.plaat ? 'checked' : '';
                const plaatDisabled = materialState.wedi.plaat ? '' : 'disabled';
                const plaatPrijs = materialState.wedi.plaat ? breakdown.plaat.prijs : 0;
                html += `<li class="material-checkbox-item ${plaatDisabled}" data-key="plaat">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${plaatChecked} onchange="toggleWediMaterial('plaat', ${dikte}, ${qty}, '${gitexMethode}')">`;
                html += `<span class="mat-name">${breakdown.plaat.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${plaatPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.plaat.verbruik} x € ${breakdown.plaat.eenheidsprijs}</div>`;
                html += '</li>';
                
                // Flexlijm
                const flexChecked = materialState.wedi.flexlijm ? 'checked' : '';
                const flexDisabled = materialState.wedi.flexlijm ? '' : 'disabled';
                const flexPrijs = materialState.wedi.flexlijm ? breakdown.flexlijm.prijs : 0;
                html += `<li class="material-checkbox-item ${flexDisabled}" data-key="flexlijm">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${flexChecked} onchange="toggleWediMaterial('flexlijm', ${dikte}, ${qty}, '${gitexMethode}')">`;
                html += `<span class="mat-name">${breakdown.flexlijm.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${flexPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.flexlijm.verbruik} x € ${breakdown.flexlijm.eenheidsprijs}</div>`;
                html += '</li>';
                
                // Gitex (variabel per methode)
                const gitexChecked = materialState.wedi.gitex ? 'checked' : '';
                const gitexDisabled = materialState.wedi.gitex ? '' : 'disabled';
                const gitexPrijs = materialState.wedi.gitex ? gitexSys.gitex_prijs : 0;
                const gitexNaam = gitexMethode === 'naden' ? 'Gitex (naden)' : 'Gitex (volledig)';
                html += `<li class="material-checkbox-item ${gitexDisabled}" data-key="gitex">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${gitexChecked} onchange="toggleWediMaterial('gitex', ${dikte}, ${qty}, '${gitexMethode}')">`;
                html += `<span class="mat-name">${gitexNaam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${gitexPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${gitexSys.gitex_verbruik.toFixed(2)} m²/m² x € 3,50</div>`;
                html += '</li>';
                
                // Snelband (variabel per methode)
                const snelChecked = materialState.wedi.snelband ? 'checked' : '';
                const snelDisabled = materialState.wedi.snelband ? '' : 'disabled';
                const snelPrijs = materialState.wedi.snelband ? gitexSys.snelband_prijs : 0;
                const snelNaam = gitexMethode === 'naden' ? 'Snelband (naden)' : 'Snelband 3mm';
                html += `<li class="material-checkbox-item ${snelDisabled}" data-key="snelband">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${snelChecked} onchange="toggleWediMaterial('snelband', ${dikte}, ${qty}, '${gitexMethode}')">`;
                html += `<span class="mat-name">${snelNaam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${snelPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${gitexSys.snelband_verbruik.toFixed(2)} kg/m² x € 0,56/kg</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="wedi-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === ULTRADUN ===
            else if (component === 'ultradun') {
                const systeem = document.getElementById('ultradun-systeem').value;
                
                // Sulfatex (basis - geen checkboxes)
                if (systeem === 'sulfatex') {
                    html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                    html += '<ul class="material-list">';
                    html += '<li>Capaciteit: 30 m²/man/dag</li>';
                    html += `<li>${qty} m² = ${(qty / 30 * 8).toFixed(2)} manuren</li>`;
                    html += '</ul>';
                    
                    html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                    html += '<ul class="material-list">';
                    html += '<li>Sulfatex waterdichting</li>';
                    html += `<li>€ 5,50/m2 x ${qty} m²</li>`;
                    html += '</ul>';
                    
                    html += '<div class="modal-total">';
                    html += '<span class="total-label">Materiaal</span>';
                    html += `<span class="total-value">€ ${(qty * 5.50).toFixed(2)}</span>`;
                    html += '</div>';
                }
                // Asocret (V9.22 two-line layout)
                else if (systeem === 'asocret') {
                    const metAutex = document.getElementById('asocret-autex').value === 'met';
                    const spec = XTRA.ultradun.asocret;
                    const cap = metAutex ? spec.cap_met_autex : spec.cap_zonder_autex;
                    const effectief_mat = getAsocretMatPrijs(metAutex);
                    
                    // Sectie 1: Capaciteit & Arbeid
                    html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                    html += '<ul class="material-list">';
                    html += `<li>Laagdikte: ${spec.laagdikte} mm (waterdicht)</li>`;
                    html += `<li>Capaciteit: ${cap} m²/man/dag</li>`;
                    html += `<li>${qty} m² = ${(qty / cap * 8).toFixed(2)} manuren</li>`;
                    html += '</ul>';
                    
                    // Sectie 2: Materiaalkosten met checkboxes
                    html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                    html += '<ul class="material-checkbox-list">';
                    
                    // Asocret mortel
                    const mortelChecked = materialState.asocret.mortel ? 'checked' : '';
                    const mortelDisabled = materialState.asocret.mortel ? '' : 'disabled';
                    const mortelPrijs = materialState.asocret.mortel ? ASOCRET_MAT_BREAKDOWN.mortel.prijs : 0;
                    html += `<li class="material-checkbox-item ${mortelDisabled}" data-key="mortel">`;
                    html += '<div class="mat-row">';
                    html += '<label>';
                    html += `<input type="checkbox" ${mortelChecked} onchange="toggleAsocretMaterial('mortel', ${metAutex}, ${qty})">`;
                    html += `<span class="mat-name">${ASOCRET_MAT_BREAKDOWN.mortel.naam}</span>`;
                    html += '</label>';
                    html += `<span class="mat-price">€ ${mortelPrijs.toFixed(2)}/m²</span>`;
                    html += '</div>';
                    html += `<div class="mat-calc">${ASOCRET_MAT_BREAKDOWN.mortel.verbruik} x € ${ASOCRET_MAT_BREAKDOWN.mortel.eenheidsprijs}</div>`;
                    html += '</li>';
                    
                    // Autex (alleen als met Autex geselecteerd)
                    if (metAutex) {
                        const autexChecked = materialState.asocret.autex ? 'checked' : '';
                        const autexDisabled = materialState.asocret.autex ? '' : 'disabled';
                        const autexPrijs = materialState.asocret.autex ? ASOCRET_MAT_BREAKDOWN.autex.prijs : 0;
                        html += `<li class="material-checkbox-item ${autexDisabled}" data-key="autex">`;
                        html += '<div class="mat-row">';
                        html += '<label>';
                        html += `<input type="checkbox" ${autexChecked} onchange="toggleAsocretMaterial('autex', ${metAutex}, ${qty})">`;
                        html += `<span class="mat-name">${ASOCRET_MAT_BREAKDOWN.autex.naam}</span>`;
                        html += '</label>';
                        html += `<span class="mat-price">€ ${autexPrijs.toFixed(2)}/m²</span>`;
                        html += '</div>';
                        html += `<div class="mat-calc">${ASOCRET_MAT_BREAKDOWN.autex.verbruik} x € ${ASOCRET_MAT_BREAKDOWN.autex.eenheidsprijs}</div>`;
                        html += '</li>';
                    }
                    
                    html += '</ul>';
                    
                    // Totaal
                    html += '<div class="modal-total">';
                    html += '<span class="total-label">Materiaal</span>';
                    html += `<span id="asocret-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                    html += '</div>';
                }
                // Sopro (V9.22 two-line layout)
                else {
                    const lagen = parseInt(document.getElementById('sopro-lagen').value) || 2;
                    const lagen_data = XTRA.ultradun.sopro.lagen[lagen];
                    const effectief_mat = getSoproMatPrijs(lagen);
                    const breakdown = SOPRO_MAT_BREAKDOWN[lagen] || SOPRO_MAT_BREAKDOWN[2];
                    
                    // Sectie 1: Capaciteit & Arbeid
                    html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                    html += '<ul class="material-list">';
                    html += `<li>Aantal lagen: ${lagen}</li>`;
                    html += `<li>Capaciteit: ${lagen_data.cap_per_man} m²/man/dag</li>`;
                    html += `<li>${qty} m² = ${(qty / lagen_data.cap_per_man * 8).toFixed(2)} manuren</li>`;
                    html += '</ul>';
                    
                    // Sectie 2: Materiaalkosten met checkboxes
                    html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                    html += '<ul class="material-checkbox-list">';
                    
                    // Sopro mortel
                    const mortelChecked = materialState.sopro.mortel ? 'checked' : '';
                    const mortelDisabled = materialState.sopro.mortel ? '' : 'disabled';
                    const mortelPrijs = materialState.sopro.mortel ? breakdown.mortel.prijs : 0;
                    html += `<li class="material-checkbox-item ${mortelDisabled}" data-key="mortel">`;
                    html += '<div class="mat-row">';
                    html += '<label>';
                    html += `<input type="checkbox" ${mortelChecked} onchange="toggleSoproMaterial('mortel', ${lagen}, ${qty})">`;
                    html += `<span class="mat-name">${breakdown.mortel.naam}</span>`;
                    html += '</label>';
                    html += `<span class="mat-price">€ ${mortelPrijs.toFixed(2)}/m²</span>`;
                    html += '</div>';
                    html += `<div class="mat-calc">${breakdown.mortel.verbruik} x € ${breakdown.mortel.eenheidsprijs}</div>`;
                    html += '</li>';
                    
                    html += '</ul>';
                    
                    // Totaal
                    html += '<div class="modal-total">';
                    html += '<span class="total-label">Materiaal</span>';
                    html += `<span id="sopro-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                    html += '</div>';
                }
            }
            // === FIX & FINISH (V9.22 two-line layout) ===
            else if (component === 'fixfinish') {
                const effectief_mat = getFixfinishMatPrijs();
                const breakdown = FIXFINISH_MAT_BREAKDOWN;
                
                // Sectie 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Capaciteit: 35 m²/man/dag</li>';
                html += `<li>${qty} m² = ${(qty / 35 * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
                
                // Sectie 2: Materiaalkosten met checkbox
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                const absChecked = materialState.fixfinish.absfinish ? 'checked' : '';
                const absDisabled = materialState.fixfinish.absfinish ? '' : 'disabled';
                const absPrijs = materialState.fixfinish.absfinish ? breakdown.absfinish.prijs : 0;
                html += `<li class="material-checkbox-item ${absDisabled}" data-key="absfinish">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${absChecked} onchange="toggleFixfinishMaterial('absfinish', ${qty})">`;
                html += `<span class="mat-name">${breakdown.absfinish.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${absPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.absfinish.verbruik} x € ${breakdown.absfinish.eenheidsprijs}</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="fixfinish-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === FASSA SHIELD (V9.22 two-line layout) ===
            else if (component === 'fassashield') {
                const effectief_mat = getFassashieldMatPrijs();
                const breakdown = FASSASHIELD_MAT_BREAKDOWN;
                
                // Sectie 1: Capaciteit & Arbeid
                html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                html += '<ul class="material-list">';
                html += '<li>Capaciteit: 15 m²/man/dag</li>';
                html += `<li>${qty} m² = ${(qty / 15 * 8).toFixed(2)} manuren</li>`;
                html += '</ul>';
                
                // Sectie 2: Materiaalkosten met checkboxes
                html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                html += '<ul class="material-checkbox-list">';
                
                // Fassa Shield membraan
                const shieldChecked = materialState.fassashield.shield ? 'checked' : '';
                const shieldDisabled = materialState.fassashield.shield ? '' : 'disabled';
                const shieldPrijs = materialState.fassashield.shield ? breakdown.shield.prijs : 0;
                html += `<li class="material-checkbox-item ${shieldDisabled}" data-key="shield">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${shieldChecked} onchange="toggleFassashieldMaterial('shield', ${qty})">`;
                html += `<span class="mat-name">${breakdown.shield.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${shieldPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.shield.verbruik} x € ${breakdown.shield.eenheidsprijs}</div>`;
                html += '</li>';
                
                // Superbond lijm
                const superbondChecked = materialState.fassashield.superbond ? 'checked' : '';
                const superbondDisabled = materialState.fassashield.superbond ? '' : 'disabled';
                const superbondPrijs = materialState.fassashield.superbond ? breakdown.superbond.prijs : 0;
                html += `<li class="material-checkbox-item ${superbondDisabled}" data-key="superbond">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${superbondChecked} onchange="toggleFassashieldMaterial('superbond', ${qty})">`;
                html += `<span class="mat-name">${breakdown.superbond.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${superbondPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.superbond.verbruik} x € ${breakdown.superbond.eenheidsprijs}</div>`;
                html += '</li>';
                
                // Afwerking
                const afwerkingChecked = materialState.fassashield.afwerking ? 'checked' : '';
                const afwerkingDisabled = materialState.fassashield.afwerking ? '' : 'disabled';
                const afwerkingPrijs = materialState.fassashield.afwerking ? breakdown.afwerking.prijs : 0;
                html += `<li class="material-checkbox-item ${afwerkingDisabled}" data-key="afwerking">`;
                html += '<div class="mat-row">';
                html += '<label>';
                html += `<input type="checkbox" ${afwerkingChecked} onchange="toggleFassashieldMaterial('afwerking', ${qty})">`;
                html += `<span class="mat-name">${breakdown.afwerking.naam}</span>`;
                html += '</label>';
                html += `<span class="mat-price">€ ${afwerkingPrijs.toFixed(2)}/m²</span>`;
                html += '</div>';
                html += `<div class="mat-calc">${breakdown.afwerking.verbruik} x € ${breakdown.afwerking.eenheidsprijs}</div>`;
                html += '</li>';
                
                html += '</ul>';
                
                // Totaal
                html += '<div class="modal-total">';
                html += '<span class="total-label">Materiaal</span>';
                html += `<span id="fassashield-mat-total" class="total-value">€ ${(qty * effectief_mat).toFixed(2)}</span>`;
                html += '</div>';
            }
            // === GRONDERING (basis modal) ===
            else if (component === 'grondering') {
                const product = document.getElementById('product-grondering').value;
                const spec = XTRA.grondering[product];
                
                if (spec) {
                    // Sectie 1: Capaciteit & Arbeid
                    html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                    html += '<ul class="material-list">';
                    html += `<li>Capaciteit: ${spec.cap_per_man} m²/man/dag</li>`;
                    html += `<li>${qty} m² = ${(qty / spec.cap_per_man * 8).toFixed(2)} manuren</li>`;
                    html += '</ul>';
                    
                    // Sectie 2: Materiaalkosten
                    html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                    html += '<ul class="material-list">';
                    html += `<li>${spec.naam}</li>`;
                    html += `<li>Verbruik: ${spec.verbruik}</li>`;
                    
                    if (spec.trapfunctie) {
                        const kg_nodig = qty * spec.verbruik_per_m2;
                        const emmers = Math.ceil(kg_nodig / spec.emmer_kg);
                        const mat_totaal = emmers * spec.emmer_prijs;
                        html += `<li>Benodigde kg: ${kg_nodig.toFixed(2)} kg</li>`;
                        html += `<li>Emmers: ${emmers} x ${spec.emmer_kg}kg @ € ${spec.emmer_prijs.toFixed(2)}</li>`;
                        html += '</ul>';
                        html += '<div class="modal-total">';
                        html += '<span class="total-label">Materiaal</span>';
                        html += `<span class="total-value">€ ${mat_totaal.toFixed(2)}</span>`;
                        html += '</div>';
                    } else {
                        const mat_totaal = qty * spec.mat;
                        html += `<li>€ ${spec.mat.toFixed(2)}/m2 x ${qty} m²</li>`;
                        html += '</ul>';
                        html += '<div class="modal-total">';
                        html += '<span class="total-label">Materiaal</span>';
                        html += `<span class="total-value">€ ${mat_totaal.toFixed(2)}</span>`;
                        html += '</div>';
                    }
                } else {
                    html += '<p style="color: #e53e3e;">Selecteer eerst een gronderingsproduct.</p>';
                }
            }
            // === HOEKPROFIELEN (basis modal) ===
            else if (component === 'hoekprofielen') {
                const oppervlakte_bezetten = parseFloat(document.getElementById('bezetten').value) || 0;
                if (oppervlakte_bezetten > 0) {
                    const mat_prijs = qty * 0.80;
                    const arb_prijs = qty * 0.25 * LOON;
                    
                    // Sectie 1: Capaciteit & Arbeid
                    html += '<div class="modal-section-title">Capaciteit & Arbeid</div>';
                    html += '<ul class="material-list">';
                    html += '<li>Arbeid: 15 min/m</li>';
                    html += `<li>${qty} m = ${(qty * 0.25).toFixed(2)} uur</li>`;
                    html += `<li>Arbeid: € ${arb_prijs.toFixed(2)}</li>`;
                    html += '</ul>';
                    
                    // Sectie 2: Materiaalkosten
                    html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                    html += '<ul class="material-list">';
                    html += '<li>MDB hoekprofiel</li>';
                    html += `<li>€ 0,80/m x ${qty} m</li>`;
                    html += '</ul>';
                    
                    html += '<div class="modal-total">';
                    html += '<span class="total-label">Totaal</span>';
                    html += `<span class="total-value">€ ${(mat_prijs + arb_prijs).toFixed(2)}</span>`;
                    html += '</div>';
                } else {
                    html += '<p style="color: #e53e3e;">Vul eerst "Bezetten" in.</p>';
                }
            }
            // === BIJKOMEND PLEISTERWERK (V9.28 puur MP75) ===
            else if (component === 'bijkomendpleister') {
                const oppervlakte_bezetten = parseFloat(document.getElementById('bezetten').value) || 0;
                if (oppervlakte_bezetten > 0 && qty > 0) {
                    const totaal_kg = qty * 25;
                    const kg_per_m2 = totaal_kg / oppervlakte_bezetten;
                    const totale_dikte = kg_per_m2 / 7.5;
                    const extra_dikte = Math.max(0, totale_dikte - 2);
                    const standaard_zakken = (oppervlakte_bezetten * 2 * 7.5) / 25;
                    
                    if (qty > standaard_zakken) {
                        const breakdown = BIJKOMENDPLEISTER_MAT_BREAKDOWN;
                        const mat_prijs = getBijkomendpleisterMatPrijs();
                        const mat_totaal = extra_dikte * mat_prijs * oppervlakte_bezetten;
                        const arb_totaal = extra_dikte * BIJKOMENDPLEISTER_ARBEID * oppervlakte_bezetten;
                        const totaal = mat_totaal + arb_totaal;
                        
                        // Sectie 1: Berekening extra dikte
                        html += '<div class="modal-section-title">Berekening extra dikte</div>';
                        html += '<ul class="material-list">';
                        html += `<li>Standaard (2cm): ${standaard_zakken.toFixed(1)} zakken</li>`;
                        html += `<li>Gebruikt: ${qty} zakken = ${totaal_kg} kg</li>`;
                        html += `<li>Totale dikte: ${totale_dikte.toFixed(2)} cm</li>`;
                        html += `<li>Extra dikte: ${extra_dikte.toFixed(2)} cm</li>`;
                        html += '</ul>';
                        
                        // Sectie 2: Materiaalkosten met checkbox
                        html += '<div class="modal-section-title" style="margin-top: 16px;">Materiaalkosten</div>';
                        html += '<ul class="material-checkbox-list">';
                        
                        const mp75Checked = materialState.bijkomendpleister.mp75 ? 'checked' : '';
                        const mp75Disabled = materialState.bijkomendpleister.mp75 ? '' : 'disabled';
                        const mp75Prijs = materialState.bijkomendpleister.mp75 ? breakdown.mp75.prijs : 0;
                        html += `<li class="material-checkbox-item ${mp75Disabled}" data-key="mp75">`;
                        html += '<div class="mat-row">';
                        html += '<label>';
                        html += `<input type="checkbox" ${mp75Checked} onchange="toggleBijkomendpleisterMaterial('mp75', ${extra_dikte}, ${oppervlakte_bezetten})">`;
                        html += `<span class="mat-name">${breakdown.mp75.naam}</span>`;
                        html += '</label>';
                        html += `<span class="mat-price">€ ${mp75Prijs.toFixed(2)}/cm/m²</span>`;
                        html += '</div>';
                        html += `<div class="mat-calc">${breakdown.mp75.verbruik} x € ${breakdown.mp75.eenheidsprijs}</div>`;
                        html += '</li>';
                        html += '</ul>';
                        
                        html += '<div class="modal-total" style="border-top: none; padding-top: 8px;">';
                        html += '<span class="total-label">Materiaal</span>';
                        html += `<span id="bijkomendpleister-mat-total" class="total-value">€ ${mat_totaal.toFixed(2)}</span>`;
                        html += '</div>';
                        
                        // Sectie 3: Arbeidskosten
                        html += '<div class="modal-section-title" style="margin-top: 16px;">Arbeidskosten</div>';
                        html += '<ul class="material-list">';
                        html += `<li>€ ${BIJKOMENDPLEISTER_ARBEID.toFixed(2)}/cm/m² x ${extra_dikte.toFixed(2)} cm x ${oppervlakte_bezetten} m²</li>`;
                        html += `<li>= € ${arb_totaal.toFixed(2)}</li>`;
                        html += '</ul>';
                        
                        // Totaal
                        html += '<div class="modal-total">';
                        html += '<span class="total-label">Totaal</span>';
                        html += `<span id="bijkomendpleister-totaal" class="total-value">€ ${totaal.toFixed(2)}</span>`;
                        html += '</div>';
                    } else {
                        html += '<p>Geen bijkomend pleisterwerk (binnen standaard 2cm).</p>';
                    }
                } else {
                    html += '<p style="color: #e53e3e;">Vul eerst "Bezetten" in.</p>';
                }
            }
            // === EGALISATIE (basis modal) ===
            else if (component === 'egalisatie') {
                const oppervlakte_bezetten = parseFloat(document.getElementById('bezetten').value) || 0;
                if (oppervlakte_bezetten > 0 && qty > 0) {
                    const totaal_kg = qty * 25;
                    const kg_per_m2 = totaal_kg / oppervlakte_bezetten;
                    const totale_dikte_mm = kg_per_m2 / 2;
                    
                    html += '<div class="modal-section-title">Berekening egalisatie</div>';
                    html += '<ul class="material-list">';
                    html += '<li>Mixemsub egalisatiemortel</li>';
                    html += `<li>${qty} zakken x 25 kg = ${totaal_kg} kg</li>`;
                    html += `<li>Dikte: ${totale_dikte_mm.toFixed(2)} mm gemiddeld</li>`;
                    html += '</ul>';
                    
                    html += '<div class="modal-section-title" style="margin-top: 16px;">Kostentoeslag</div>';
                    html += '<ul class="material-list">';
                    html += `<li>€ 3,50/mm/m² x ${totale_dikte_mm.toFixed(2)} mm x ${oppervlakte_bezetten} m²</li>`;
                    html += '</ul>';
                    
                    html += '<div class="modal-total">';
                    html += '<span class="total-label">Totaal</span>';
                    html += `<span class="total-value">€ ${(totale_dikte_mm * 3.50 * oppervlakte_bezetten).toFixed(2)}</span>`;
                    html += '</div>';
                } else {
                    html += '<p style="color: #e53e3e;">Vul eerst "Bezetten" in.</p>';
                }
            }
        } else {
            html += '<p style="color: var(--text-muted);">';
            html += 'Vul eerst een hoeveelheid in om de materiaalinfo te zien.</p>';
        }
        
        html += '</div>';
        body.innerHTML = html;
        document.getElementById('modal-overlay').classList.add('active');
        document.body.style.overflow = 'hidden';
    };

    window.closeModal = function(event) {
        if (event && event.target.closest('.info-modal') && 
            !event.target.classList.contains('modal-close')) {
            return;
        }
        document.getElementById('modal-overlay').classList.remove('active');
        document.body.style.overflow = '';
    };

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const overlay = document.getElementById('modal-overlay');
            if (overlay && overlay.classList.contains('active')) {
                closeModal();
                e.preventDefault();
            }
        }
    });

    // V9.21: Toggle Wedi materiaal checkbox en herbereken (met gitex methode)
    window.toggleWediMaterial = function(materialKey, dikte, qty, gitexMethode) {
        // Toggle state
        materialState.wedi[materialKey] = !materialState.wedi[materialKey];
        
        // Herbereken effectieve materiaalprijs
        const effectief_mat = getWediMatPrijs(dikte, gitexMethode);
        const breakdown = WEDI_MAT_BREAKDOWN[dikte] || WEDI_MAT_BREAKDOWN[10];
        const gitexSys = WEDI_GITEX_SYSTEMS[gitexMethode] || WEDI_GITEX_SYSTEMS.naden;
        
        // Update totaal in modal
        const totalEl = document.getElementById('wedi-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        // Update checkbox item styling - vaste volgorde: plaat, flexlijm, gitex, snelband
        const checkboxItems = document.querySelectorAll('.material-checkbox-item');
        const materials = ['plaat', 'flexlijm', 'gitex', 'snelband'];
        
        materials.forEach((key, idx) => {
            const item = checkboxItems[idx];
            if (item) {
                let prijs = 0;
                if (materialState.wedi[key]) {
                    if (key === 'plaat') prijs = breakdown.plaat.prijs;
                    else if (key === 'flexlijm') prijs = breakdown.flexlijm.prijs;
                    else if (key === 'gitex') prijs = gitexSys.gitex_prijs;
                    else if (key === 'snelband') prijs = gitexSys.snelband_prijs;
                }
                
                const priceEl = item.querySelector('.mat-price');
                if (priceEl) {
                    priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
                }
                if (materialState.wedi[key]) {
                    item.classList.remove('disabled');
                } else {
                    item.classList.add('disabled');
                }
            }
        });
        
        // Trigger hoofdberekening om componentkaart te updaten
        calculate();
    };
    
    // V9.24: Toggle Injecties materiaal checkbox (alleen Fassa Inject)
    window.toggleInjectiesMaterial = function(materialKey, qty) {
        materialState.injecties[materialKey] = !materialState.injecties[materialKey];
        const effectief_mat = getInjectiesMatPrijs();
        
        const totalEl = document.getElementById('injecties-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const item = document.querySelector('.material-checkbox-item[data-key="fassainject"]');
        if (item) {
            const prijs = materialState.injecties.fassainject ? INJECTIES_MAT_BREAKDOWN.fassainject.prijs : 0;
            const priceEl = item.querySelector('.mat-price');
            if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m`;
            item.classList.toggle('disabled', !materialState.injecties.fassainject);
        }
        
        calculate();
    };
    
    // V9.26: Toggle Membraan materiaal checkbox (CODEX + SNC)
    window.toggleMembraanMaterial = function(materialKey, qty) {
        materialState.membraan[materialKey] = !materialState.membraan[materialKey];
        const effectief_mat = getMembraanMatPrijs();
        
        const totalEl = document.getElementById('membraan-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        // Update beide checkbox items
        const materials = ['codex', 'snc'];
        materials.forEach(key => {
            const item = document.querySelector(`.material-checkbox-item[data-key="${key}"]`);
            if (item) {
                const prijs = materialState.membraan[key] ? MEMBRAAN_MAT_BREAKDOWN[key].prijs : 0;
                const priceEl = item.querySelector('.mat-price');
                if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
                item.classList.toggle('disabled', !materialState.membraan[key]);
            }
        });
        
        calculate();
    };
    
    // V9.22: Toggle Bezetten materiaal checkbox
    window.toggleBezettenMaterial = function(materialKey, qty) {
        materialState.bezetten[materialKey] = !materialState.bezetten[materialKey];
        const effectief_mat = getBezettenMatPrijs();
        
        const totalEl = document.getElementById('bezetten-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const item = document.querySelector('.material-checkbox-item[data-key="mp75"]');
        if (item) {
            const prijs = materialState.bezetten.mp75 ? BEZETTEN_MAT_BREAKDOWN.mp75.prijs : 0;
            const priceEl = item.querySelector('.mat-price');
            if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
            item.classList.toggle('disabled', !materialState.bezetten.mp75);
        }
        
        calculate();
    };
    
    // V9.27: Toggle XPS materiaal checkbox (zonder PU-schuim)
    window.toggleXpsMaterial = function(materialKey, dikte, qty) {
        materialState.xps[materialKey] = !materialState.xps[materialKey];
        const effectief_mat = getXpsMatPrijs(dikte);
        const breakdown = XPS_MAT_BREAKDOWN[dikte] || XPS_MAT_BREAKDOWN[40];
        
        const totalEl = document.getElementById('xps-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const materials = ['plaat', 'lgips', 'gitex', 'snelband'];
        materials.forEach(key => {
            const item = document.querySelector(`.material-checkbox-item[data-key="${key}"]`);
            if (item) {
                const prijs = materialState.xps[key] ? breakdown[key].prijs : 0;
                const priceEl = item.querySelector('.mat-price');
                if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
                item.classList.toggle('disabled', !materialState.xps[key]);
            }
        });
        
        calculate();
    };
    
    // V9.29: Toggle Sopro materiaal checkbox (alleen mortel)
    window.toggleSoproMaterial = function(materialKey, lagen, qty) {
        materialState.sopro[materialKey] = !materialState.sopro[materialKey];
        const effectief_mat = getSoproMatPrijs(lagen);
        const breakdown = SOPRO_MAT_BREAKDOWN[lagen] || SOPRO_MAT_BREAKDOWN[2];
        
        const totalEl = document.getElementById('sopro-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const materials = ['mortel'];
        materials.forEach(key => {
            const item = document.querySelector(`.material-checkbox-item[data-key="${key}"]`);
            if (item) {
                const prijs = materialState.sopro[key] ? breakdown[key].prijs : 0;
                const priceEl = item.querySelector('.mat-price');
                if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
                item.classList.toggle('disabled', !materialState.sopro[key]);
            }
        });
        
        calculate();
    };
    
    // V9.22: Toggle Asocret materiaal checkbox
    window.toggleAsocretMaterial = function(materialKey, metAutex, qty) {
        materialState.asocret[materialKey] = !materialState.asocret[materialKey];
        const effectief_mat = getAsocretMatPrijs(metAutex);
        
        const totalEl = document.getElementById('asocret-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const materials = ['mortel', 'autex'];
        materials.forEach(key => {
            const item = document.querySelector(`.material-checkbox-item[data-key="${key}"]`);
            if (item) {
                let prijs = 0;
                if (key === 'mortel' && materialState.asocret.mortel) {
                    prijs = ASOCRET_MAT_BREAKDOWN.mortel.prijs;
                } else if (key === 'autex' && metAutex && materialState.asocret.autex) {
                    prijs = ASOCRET_MAT_BREAKDOWN.autex.prijs;
                }
                const priceEl = item.querySelector('.mat-price');
                if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
                item.classList.toggle('disabled', key === 'autex' ? 
                    (!metAutex || !materialState.asocret.autex) : !materialState.asocret[key]);
            }
        });
        
        calculate();
    };
    
    // V9.22: Toggle Fix & Finish materiaal checkbox
    window.toggleFixfinishMaterial = function(materialKey, qty) {
        materialState.fixfinish[materialKey] = !materialState.fixfinish[materialKey];
        const effectief_mat = getFixfinishMatPrijs();
        
        const totalEl = document.getElementById('fixfinish-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const item = document.querySelector('.material-checkbox-item[data-key="absfinish"]');
        if (item) {
            const prijs = materialState.fixfinish.absfinish ? 
                FIXFINISH_MAT_BREAKDOWN.absfinish.prijs : 0;
            const priceEl = item.querySelector('.mat-price');
            if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
            item.classList.toggle('disabled', !materialState.fixfinish.absfinish);
        }
        
        calculate();
    };
    
    // V9.22: Toggle Fassa Shield materiaal checkbox
    window.toggleFassashieldMaterial = function(materialKey, qty) {
        materialState.fassashield[materialKey] = !materialState.fassashield[materialKey];
        const effectief_mat = getFassashieldMatPrijs();
        
        const totalEl = document.getElementById('fassashield-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(qty * effectief_mat).toFixed(2)}`;
        }
        
        const materials = ['shield', 'superbond', 'afwerking'];
        materials.forEach(key => {
            const item = document.querySelector(`.material-checkbox-item[data-key="${key}"]`);
            if (item) {
                const prijs = materialState.fassashield[key] ? 
                    FASSASHIELD_MAT_BREAKDOWN[key].prijs : 0;
                const priceEl = item.querySelector('.mat-price');
                if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/m²`;
                item.classList.toggle('disabled', !materialState.fassashield[key]);
            }
        });
        
        calculate();
    };
    
    // V9.28: Toggle Bijkomend pleisterwerk materiaal checkbox
    window.toggleBijkomendpleisterMaterial = function(materialKey, extraDikte, oppervlakte) {
        materialState.bijkomendpleister[materialKey] = !materialState.bijkomendpleister[materialKey];
        const mat_prijs = getBijkomendpleisterMatPrijs();
        const totaal_prijs = mat_prijs + BIJKOMENDPLEISTER_ARBEID;
        const totaal = extraDikte * totaal_prijs * oppervlakte;
        
        const totalEl = document.getElementById('bijkomendpleister-mat-total');
        if (totalEl) {
            totalEl.textContent = `€ ${(extraDikte * mat_prijs * oppervlakte).toFixed(2)}`;
        }
        
        const totaalTotEl = document.getElementById('bijkomendpleister-totaal');
        if (totaalTotEl) {
            totaalTotEl.textContent = `€ ${totaal.toFixed(2)}`;
        }
        
        const item = document.querySelector('.material-checkbox-item[data-key="mp75"]');
        if (item) {
            const prijs = materialState.bijkomendpleister.mp75 ? 
                BIJKOMENDPLEISTER_MAT_BREAKDOWN.mp75.prijs : 0;
            const priceEl = item.querySelector('.mat-price');
            if (priceEl) priceEl.textContent = `€ ${prijs.toFixed(2)}/cm/m²`;
            item.classList.toggle('disabled', !materialState.bijkomendpleister.mp75);
        }
        
        calculate();
    };

    // === BEREKENINGEN ===
    function isEvenredigVerdeeld(qty) {
        if (qty.afkappen <= 0 || qty.injecties <= 0 || 
            qty.membraan <= 0 || qty.bezetten <= 0) {
            return false;
        }
        const values = [qty.afkappen, qty.injecties, qty.membraan, qty.bezetten];
        const first = values[0];
        const tolerance = 0.01;
        return values.every(v => Math.abs(v - first) < tolerance);
    }

    function berekenVasteTarieven(qty) {
        const tarieven = {
            afkappen: 13,
            injecties: 31,
            membraan: 28,
            bezetten: 38
        };
        
        const result = { 
            manuren: 0, mat: 0, loon: 0, TO: 0, 
            totaal: 0, winst: 0, werkdagen_TO: 0 
        };
        
        let totaal_manuren = 0;
        ['afkappen', 'injecties', 'membraan', 'bezetten'].forEach(comp => {
            if (qty[comp] > 0) {
                const manuren = (qty[comp] / COMP[comp].cap_per_man) * 8;
                totaal_manuren += manuren;
            }
        });
        
        result.manuren = totaal_manuren;
        let werkdagen = 0;
        if (totaal_manuren > 0) {
            // V8.4: Correcte T&O berekening met 4-uur tolerantie
            werkdagen = Math.ceil(totaal_manuren / 16);
            const overschot = totaal_manuren % 16;
            if (overschot > 0 && overschot <= 4) {
                werkdagen = Math.floor(totaal_manuren / 16);
            }
            if (werkdagen < 1) werkdagen = 1;
        }
        result.werkdagen_TO = werkdagen;
        
        ['afkappen', 'injecties', 'membraan', 'bezetten'].forEach(comp => {
            if (qty[comp] > 0) {
                const prijs_per_eenheid = tarieven[comp];
                const subtotaal = qty[comp] * prijs_per_eenheid;
                const tijd = (qty[comp] / COMP[comp].cap_per_man) * 8;
                
                // V9.25: Effectieve materiaalprijs op basis van checkboxes
                let mat_prijs;
                if (comp === 'injecties') {
                    mat_prijs = getInjectiesMatPrijs();
                } else if (comp === 'membraan') {
                    mat_prijs = getMembraanMatPrijs();
                } else if (comp === 'bezetten') {
                    mat_prijs = getBezettenMatPrijs();
                } else {
                    mat_prijs = COMP[comp].mat; // afkappen heeft geen checkboxes
                }
                const mat = qty[comp] * mat_prijs;
                const loon = tijd * LOON;
                
                result[comp] = { 
                    prijs: prijs_per_eenheid,
                    subtotaal: subtotaal,
                    tijd: tijd,
                    manuren: tijd,
                    mat: mat,
                    loon: loon
                };
                
                result.totaal += subtotaal;
                result.mat += mat;
                result.loon += loon;
            }
        });
        
        result.TO = result.werkdagen_TO * TO_PER_DAG;
        result.winst = result.totaal * 0.25;
        
        const kosten = result.totaal * 0.75;
        const werkelijke_kosten = result.mat + result.loon + result.TO;
        
        if (werkelijke_kosten > 0) {
            const factor = kosten / werkelijke_kosten;
            result.loon = result.loon * factor;
        }
        
        result.mat = result.totaal - result.loon - result.TO - result.winst;
        return result;
    }

    function berekenDynamisch(qty) {
        const result = { 
            manuren: 0, mat: 0, loon: 0, TO: 0, 
            totaal: 0, winst: 0 
        };
        
        // V9.25: Gebruik effectieve prijs functies voor checkbox sync
        ['afkappen', 'injecties', 'membraan', 'bezetten'].forEach(comp => {
            if (qty[comp] > 0) {
                const manuren = (qty[comp] / COMP[comp].cap_per_man) * 8;
                const loon = manuren * LOON;
                
                // V9.25: Effectieve materiaalprijs op basis van checkboxes
                let mat_prijs;
                if (comp === 'injecties') {
                    mat_prijs = getInjectiesMatPrijs();
                } else if (comp === 'membraan') {
                    mat_prijs = getMembraanMatPrijs();
                } else if (comp === 'bezetten') {
                    mat_prijs = getBezettenMatPrijs();
                } else {
                    mat_prijs = COMP[comp].mat; // afkappen heeft geen checkboxes
                }
                const mat = qty[comp] * mat_prijs;
                
                // V9.25: Alle properties voor card display
                const subtotaal = mat + loon;
                const prijs = subtotaal / qty[comp];
                
                result[comp] = { 
                    manuren, loon, mat, 
                    tijd: manuren,
                    prijs: prijs,
                    subtotaal: subtotaal
                };
                result.manuren += manuren;
                result.loon += loon;
                result.mat += mat;
            }
        });

        // V9.25: XPS met effectieve prijs functie
        if (qty.xps > 0) {
            const dikte = parseInt(document.getElementById('xps-dikte').value);
            const mat_prijs = getXpsMatPrijs(dikte);
            const manuren = (qty.xps / XTRA.xps.cap_per_man) * 8;
            const loon = manuren * LOON;
            const mat = qty.xps * mat_prijs;
            const subtotaal = mat + loon;
            const prijs = subtotaal / qty.xps;
            
            result.xps = { 
                manuren, loon, mat,
                tijd: manuren,
                prijs: prijs,
                subtotaal: subtotaal
            };
            result.manuren += manuren;
            result.loon += loon;
            result.mat += mat;
        }

        if (qty.wedi > 0) {
            const dikte = parseInt(document.getElementById('wedi-dikte').value) || 10;
            const gitexMethode = document.getElementById('wedi-gitex').value || 'naden';
            // V9.21: Gebruik effectieve prijs en capaciteit op basis van gitex methode
            const mat_prijs = getWediMatPrijs(dikte, gitexMethode);
            const cap_per_man = getWediCapaciteit(gitexMethode);
            const manuren = (qty.wedi / cap_per_man) * 8;
            const loon = manuren * LOON;
            const mat = qty.wedi * mat_prijs;
            const subtotaal = mat + loon;
            const prijs = subtotaal / qty.wedi;
            
            result.wedi = { 
                manuren, loon, mat,
                tijd: manuren,
                prijs: prijs,
                subtotaal: subtotaal
            };
            result.manuren += manuren;
            result.loon += loon;
            result.mat += mat;
        }

        if (qty.ultradun > 0) {
            const systeem = document.getElementById('ultradun-systeem').value;
            
            let mat, cap_per_man;
            if (systeem === 'sopro') {
                // V9.25: Sopro met effectieve prijs functie
                const lagen = parseInt(document.getElementById('sopro-lagen').value) || 2;
                const lagen_data = XTRA.ultradun.sopro.lagen[lagen];
                cap_per_man = lagen_data.cap_per_man;
                mat = qty.ultradun * getSoproMatPrijs(lagen);
            } else if (systeem === 'asocret') {
                // V9.25: Asocret met effectieve prijs functie
                const metAutex = document.getElementById('asocret-autex').value === 'met';
                if (metAutex) {
                    cap_per_man = XTRA.ultradun.asocret.cap_met_autex;
                } else {
                    cap_per_man = XTRA.ultradun.asocret.cap_zonder_autex;
                }
                mat = qty.ultradun * getAsocretMatPrijs(metAutex);
            } else {
                // Sulfatex: geen checkboxes, originele berekening
                const systeem_data = XTRA.ultradun.sulfatex;
                cap_per_man = systeem_data.cap_per_man;
                mat = qty.ultradun * systeem_data.mat;
            }
            
            const manuren = (qty.ultradun / cap_per_man) * 8;
            const loon = manuren * LOON;
            const subtotaal = mat + loon;
            const prijs = subtotaal / qty.ultradun;
            
            result.ultradun = { 
                manuren, loon, mat,
                tijd: manuren,
                prijs: prijs,
                subtotaal: subtotaal
            };
            result.manuren += manuren;
            result.loon += loon;
            result.mat += mat;
        }

        // V9.25: Fixfinish met effectieve prijs functie
        if (qty.fixfinish > 0) {
            const manuren = (qty.fixfinish / XTRA.fixfinish.cap_per_man) * 8;
            const loon = manuren * LOON;
            const mat = qty.fixfinish * getFixfinishMatPrijs();
            const subtotaal = mat + loon;
            const prijs = subtotaal / qty.fixfinish;
            
            result.fixfinish = { 
                manuren, loon, mat,
                tijd: manuren,
                prijs: prijs,
                subtotaal: subtotaal
            };
            result.manuren += manuren;
            result.loon += loon;
            result.mat += mat;
        }

        // V9.25: Fassashield met effectieve prijs functie
        if (qty.fassashield > 0) {
            const manuren = (qty.fassashield / XTRA.fassashield.cap_per_man) * 8;
            const loon = manuren * LOON;
            const mat = qty.fassashield * getFassashieldMatPrijs();
            const subtotaal = mat + loon;
            const prijs = subtotaal / qty.fassashield;
            
            result.fassashield = { 
                manuren, loon, mat,
                tijd: manuren,
                prijs: prijs,
                subtotaal: subtotaal
            };
            result.manuren += manuren;
            result.loon += loon;
            result.mat += mat;
        }

        // V8.8: Grondering Muur
        if (qty.grondering > 0) {
            const product = document.getElementById('product-grondering').value || 'stucprimer';
            const spec = XTRA.grondering[product];
            
            let mat;
            let emmers = 0;
            if (spec && spec.trapfunctie) {
                // Technicure AS: trapfunctie (emmer-afronding)
                const kg_nodig = qty.grondering * spec.verbruik_per_m2;
                emmers = Math.ceil(kg_nodig / spec.emmer_kg);
                mat = emmers * spec.emmer_prijs;
            } else if (spec) {
                mat = qty.grondering * spec.mat;
            } else {
                mat = 0;
            }
            
            const cap = spec ? spec.cap_per_man : 140;
            const manuren = (qty.grondering / cap) * 8;
            const loon = manuren * LOON;
            
            result.grondering = { manuren, loon, mat, emmers, tijd: manuren };
            result.manuren += manuren;
            result.loon += loon;
            result.mat += mat;
        }

        // V9.28 FIX: Defensieve herberekening van result.manuren voor T&O
        // Voorkomt inconsistentie wanneer manuren verkeerd werden opgeteld
        let verified_manuren = 0;
        let verified_loon = 0;
        let verified_mat = 0;
        ['afkappen', 'injecties', 'membraan', 'bezetten', 'xps', 'wedi',
         'ultradun', 'fixfinish', 'fassashield', 'grondering'].forEach(comp => {
            if (result[comp]) {
                verified_manuren += result[comp].manuren || 0;
                verified_loon += result[comp].loon || 0;
                verified_mat += result[comp].mat || 0;
            }
        });
        result.manuren = verified_manuren;
        result.loon = verified_loon;
        result.mat = verified_mat;

        let werkdagen = 0;
        if (result.manuren > 0) {
            // V8.4: Correcte T&O berekening met 4-uur tolerantie
            werkdagen = Math.ceil(result.manuren / 16);
            const overschot = result.manuren % 16;
            if (overschot > 0 && overschot <= 4) {
                werkdagen = Math.floor(result.manuren / 16);
            }
            if (werkdagen < 1) werkdagen = 1;
        }
        result.werkdagen_TO = werkdagen;
        result.TO = result.werkdagen_TO * TO_PER_DAG;

        const werkelijke_kosten = result.mat + result.loon + result.TO;
        result.winst = werkelijke_kosten / 3;
        result.totaal = werkelijke_kosten + result.winst;

        ['afkappen', 'injecties', 'membraan', 'bezetten', 'xps', 'wedi',
         'ultradun', 'fixfinish', 'fassashield', 'grondering'].forEach(comp => {
            if (result[comp]) {
                const comp_manuren = result[comp].manuren;
                const comp_ratio = comp_manuren / result.manuren;
                
                result[comp].TO = result.TO * comp_ratio;
                
                const comp_kosten = result[comp].mat + 
                                   result[comp].loon + 
                                   result[comp].TO;
                result[comp].winst = comp_kosten / 3;
                result[comp].subtotaal = comp_kosten + result[comp].winst;
                result[comp].prijs = result[comp].subtotaal / qty[comp];
                result[comp].tijd = result[comp].manuren;
            }
        });

        // Herbereken op basis van afgeronde eenheidsprijzen
        let totaal_herberekend = 0;
        ['afkappen', 'injecties', 'membraan', 'bezetten', 'xps', 'wedi',
         'ultradun', 'fixfinish', 'fassashield', 'grondering'].forEach(comp => {
            if (result[comp] && qty[comp] > 0) {
                const eenheidsprijs_afgerond = Math.round(result[comp].prijs * 100) / 100;
                const subtotaal_nieuw = qty[comp] * eenheidsprijs_afgerond;
                result[comp].subtotaal = subtotaal_nieuw;
                result[comp].prijs = eenheidsprijs_afgerond;
                totaal_herberekend += subtotaal_nieuw;
            }
        });
        result.totaal = totaal_herberekend;

        return result;
    }

    function calculate() {
        const qty = {
            afkappen: parseFloat(document.getElementById('afkappen').value) || 0,
            injecties: parseFloat(document.getElementById('injecties').value) || 0,
            membraan: parseFloat(document.getElementById('membraan').value) || 0,
            bezetten: parseFloat(document.getElementById('bezetten').value) || 0,
            xps: parseFloat(document.getElementById('xps').value) || 0,
            wedi: parseFloat(document.getElementById('wedi').value) || 0,
            ultradun: parseFloat(document.getElementById('ultradun').value) || 0,
            fixfinish: parseFloat(document.getElementById('fixfinish').value) || 0,
            fassashield: parseFloat(document.getElementById('fassashield').value) || 0,
            grondering: parseFloat(document.getElementById('grondering').value) || 0
        };

        let result;
        
        if (isEvenredigVerdeeld(qty) && qty.xps === 0 && qty.wedi === 0 && 
            qty.ultradun === 0 && qty.fixfinish === 0 && qty.fassashield === 0 &&
            qty.grondering === 0) {
            result = berekenVasteTarieven(qty);
        } else {
            result = berekenDynamisch(qty);
        }

        // === BIJKOMEND PLEISTERWERK ===
        let bijkomend_totaal = 0;
        const bijkomendpleister_zakken = parseFloat(
            document.getElementById('bijkomendpleister').value) || 0;
        const oppervlakte_bezetten = qty.bezetten;
        
        if (bijkomendpleister_zakken > 0 && oppervlakte_bezetten > 0) {
            const totaal_kg = bijkomendpleister_zakken * 25;
            const kg_per_m2 = totaal_kg / oppervlakte_bezetten;
            const totale_dikte = kg_per_m2 / 7.5;
            const extra_dikte = Math.max(0, totale_dikte - 2);
            const standaard_zakken = (oppervlakte_bezetten * 2 * 7.5) / 25;
            
            if (bijkomendpleister_zakken > standaard_zakken) {
                // V9.28: Dynamische prijs op basis van materialState
                const mat_prijs = getBijkomendpleisterMatPrijs();
                const totaal_prijs = mat_prijs + BIJKOMENDPLEISTER_ARBEID;
                bijkomend_totaal = extra_dikte * totaal_prijs * oppervlakte_bezetten;
                
                const prijs_per_m2 = bijkomend_totaal / oppervlakte_bezetten;
                document.getElementById('price-bijkomendpleister').textContent = 
                    `€ ${prijs_per_m2.toFixed(2)}/m²`;
                document.getElementById('totale-dikte-bijkomendpleister').textContent = 
                    `${totale_dikte.toFixed(2)} cm`;
                document.getElementById('extra-dikte-bijkomendpleister').textContent = 
                    `${extra_dikte.toFixed(2)} cm`;
                document.getElementById('tot-bijkomendpleister').textContent = 
                    `€ ${bijkomend_totaal.toFixed(2)}`;
                
                document.getElementById('card-bijkomendpleister').classList.remove('dormant');
                document.getElementById('breakdown-bijkomendpleister').classList.add('show');
            } else {
                document.getElementById('card-bijkomendpleister').classList.add('dormant');
                document.getElementById('breakdown-bijkomendpleister').classList.remove('show');
                document.getElementById('price-bijkomendpleister').textContent = '€ 0,00/m²';
                document.getElementById('totale-dikte-bijkomendpleister').textContent = '0 cm';
                document.getElementById('extra-dikte-bijkomendpleister').textContent = '0 cm';
                document.getElementById('tot-bijkomendpleister').textContent = '€ 0';
            }
        } else {
            document.getElementById('card-bijkomendpleister').classList.add('dormant');
            document.getElementById('breakdown-bijkomendpleister').classList.remove('show');
            document.getElementById('price-bijkomendpleister').textContent = '€ 0,00/m²';
            document.getElementById('totale-dikte-bijkomendpleister').textContent = '0 cm';
            document.getElementById('extra-dikte-bijkomendpleister').textContent = '0 cm';
            document.getElementById('tot-bijkomendpleister').textContent = '€ 0';
        }

        // === EGALISATIE ===
        let egalisatie_totaal = 0;
        const egalisatie_zakken = parseFloat(
            document.getElementById('egalisatie').value) || 0;
        
        if (egalisatie_zakken > 0 && oppervlakte_bezetten > 0) {
            const totaal_kg = egalisatie_zakken * 25;
            const kg_per_m2 = totaal_kg / oppervlakte_bezetten;
            const totale_dikte_mm = kg_per_m2 / 2;
            
            egalisatie_totaal = totale_dikte_mm * 3.50 * oppervlakte_bezetten;
            
            const prijs_per_m2 = egalisatie_totaal / oppervlakte_bezetten;
            document.getElementById('price-egalisatie').textContent = 
                `€ ${prijs_per_m2.toFixed(2)}/m²`;
            document.getElementById('totale-dikte-egalisatie').textContent = 
                `${totale_dikte_mm.toFixed(2)} mm`;
            document.getElementById('tot-egalisatie').textContent = 
                `€ ${egalisatie_totaal.toFixed(2)}`;
            
            document.getElementById('card-egalisatie').classList.remove('dormant');
            document.getElementById('breakdown-egalisatie').classList.add('show');
        } else {
            document.getElementById('card-egalisatie').classList.add('dormant');
            document.getElementById('breakdown-egalisatie').classList.remove('show');
            document.getElementById('price-egalisatie').textContent = '€ 0,00/m²';
            document.getElementById('totale-dikte-egalisatie').textContent = '0 mm';
            document.getElementById('tot-egalisatie').textContent = '€ 0';
        }

        // === HOEKPROFIELEN ===
        let hoekprofielen_totaal = 0;
        const hoekprofielen_meters = parseFloat(
            document.getElementById('hoekprofielen').value) || 0;
        
        if (hoekprofielen_meters > 0 && oppervlakte_bezetten > 0) {
            const hoekprofielen_mat = hoekprofielen_meters * 0.80;
            const hoekprofielen_tijd = hoekprofielen_meters * 0.25;
            const hoekprofielen_arb = hoekprofielen_tijd * LOON;
            
            hoekprofielen_totaal = hoekprofielen_mat + hoekprofielen_arb;
            
            const prijs_per_meter = 0.80 + (0.25 * LOON);
            document.getElementById('price-hoekprofielen').textContent = 
                `€ ${prijs_per_meter.toFixed(2)}/m`;
            document.getElementById('mat-hoekprofielen').textContent = 
                `€ ${hoekprofielen_mat.toFixed(2)}`;
            document.getElementById('arb-hoekprofielen').textContent = 
                `€ ${hoekprofielen_arb.toFixed(2)}`;
            
            const uren = Math.floor(hoekprofielen_tijd);
            const minuten = Math.round((hoekprofielen_tijd - uren) * 60);
            document.getElementById('tijd-hoekprofielen').textContent = 
                `${uren}u ${minuten}m`;
            document.getElementById('tot-hoekprofielen').textContent = 
                `€ ${hoekprofielen_totaal.toFixed(2)}`;
            
            document.getElementById('card-hoekprofielen').classList.remove('dormant');
            document.getElementById('breakdown-hoekprofielen').classList.add('show');
        } else {
            document.getElementById('card-hoekprofielen').classList.add('dormant');
            document.getElementById('breakdown-hoekprofielen').classList.remove('show');
            document.getElementById('price-hoekprofielen').textContent = '€ 0,00/m';
            document.getElementById('mat-hoekprofielen').textContent = '€ 0';
            document.getElementById('arb-hoekprofielen').textContent = '€ 0';
            document.getElementById('tijd-hoekprofielen').textContent = '0u 0m';
            document.getElementById('tot-hoekprofielen').textContent = '€ 0';
        }
        
        // Toon/verberg bijkomend rijen
        document.getElementById('row-bijkomendpleister').style.display = 
            bijkomend_totaal > 0 ? 'flex' : 'none';
        document.getElementById('row-egalisatie').style.display = 
            egalisatie_totaal > 0 ? 'flex' : 'none';
        document.getElementById('row-hoekprofielen').style.display = 
            hoekprofielen_totaal > 0 ? 'flex' : 'none';
        
        // Update titels
        const hoofdTitle = document.getElementById('hoofdcomponenten-title');
        const hasExtraComponents = qty.xps > 0 || qty.wedi > 0 || qty.ultradun > 0 || 
                                   qty.fixfinish > 0 || qty.fassashield > 0 || qty.grondering > 0;
        hoofdTitle.textContent = hasExtraComponents ? 
            'Hoofd- en Extra Componenten' : 'Hoofdcomponenten';
        
        const bijkomendTitle = document.getElementById('bijkomend-title');
        bijkomendTitle.style.display = 
            (bijkomend_totaal > 0 || egalisatie_totaal > 0 || hoekprofielen_totaal > 0) 
            ? 'block' : 'none';
        
        // Herbereken bijkomend werk met afgeronde eenheidsprijzen
        if (bijkomend_totaal > 0 && oppervlakte_bezetten > 0) {
            const eenheidsprijs = bijkomend_totaal / oppervlakte_bezetten;
            const eenheidsprijs_afgerond = Math.round(eenheidsprijs * 100) / 100;
            bijkomend_totaal = oppervlakte_bezetten * eenheidsprijs_afgerond;
        }
        
        if (egalisatie_totaal > 0 && oppervlakte_bezetten > 0) {
            const eenheidsprijs = egalisatie_totaal / oppervlakte_bezetten;
            const eenheidsprijs_afgerond = Math.round(eenheidsprijs * 100) / 100;
            egalisatie_totaal = oppervlakte_bezetten * eenheidsprijs_afgerond;
        }
        
        if (hoekprofielen_totaal > 0 && hoekprofielen_meters > 0) {
            const eenheidsprijs = hoekprofielen_totaal / hoekprofielen_meters;
            const eenheidsprijs_afgerond = Math.round(eenheidsprijs * 100) / 100;
            hoekprofielen_totaal = hoekprofielen_meters * eenheidsprijs_afgerond;
        }
        
        const bijkomend_werk_kosten = bijkomend_totaal + egalisatie_totaal + hoekprofielen_totaal;
        if (bijkomend_werk_kosten > 0) {
            result.totaal += bijkomend_werk_kosten;
        }

        // Update component cards
        ['afkappen', 'injecties', 'membraan', 'bezetten', 'xps', 'wedi',
         'ultradun', 'fixfinish', 'fassashield', 'grondering'].forEach(comp => {
            const card = document.getElementById(`card-${comp}`);
            const breakdown = document.getElementById(`breakdown-${comp}`);
            
            if (qty[comp] > 0 && result[comp]) {
                card.classList.remove('dormant');
                breakdown.classList.add('show');
                
                const unit = (comp === 'injecties') ? 'm' : 'm²';
                document.getElementById(`price-${comp}`).textContent = 
                    `€ ${result[comp].prijs.toFixed(2)}/${unit}`;
                document.getElementById(`mat-${comp}`).textContent = 
                    `€ ${result[comp].mat.toFixed(2)}`;
                document.getElementById(`arb-${comp}`).textContent = 
                    `€ ${result[comp].loon.toFixed(2)}`;
                
                const uren = Math.floor(result[comp].tijd);
                const minuten = Math.round((result[comp].tijd - uren) * 60);
                document.getElementById(`tijd-${comp}`).textContent = 
                    `${uren}u ${minuten}m`;
                document.getElementById(`tot-${comp}`).textContent = 
                    `€ ${result[comp].subtotaal.toFixed(2)}`;
            } else {
                card.classList.add('dormant');
                breakdown.classList.remove('show');
                document.getElementById(`price-${comp}`).textContent = 
                    `€ 0,00/${(comp === 'injecties') ? 'm' : 'm²'}`;
            }
        });

        // Update summary
        const hasAnyValue = result.totaal > 0;
        document.getElementById('summary').classList.toggle('dormant', !hasAnyValue);

        const totaal_uren = Math.floor(result.manuren);
        const totaal_minuten = Math.round((result.manuren - totaal_uren) * 60);
        document.getElementById('total-tijd').textContent = 
            `${totaal_uren}u ${totaal_minuten}m`;
        document.getElementById('total-arbeid').textContent = 
            `€ ${result.loon.toFixed(2)}`;
        document.getElementById('total-materiaal').textContent = 
            `€ ${result.mat.toFixed(2)}`;
        document.getElementById('total-to').textContent = 
            `€ ${result.TO.toFixed(2)}`;
        document.getElementById('total-bijkomendpleister').textContent = 
            `€ ${bijkomend_totaal.toFixed(2)}`;
        document.getElementById('total-egalisatie').textContent = 
            `€ ${egalisatie_totaal.toFixed(2)}`;
        document.getElementById('total-hoekprofielen').textContent = 
            `€ ${hoekprofielen_totaal.toFixed(2)}`;
        document.getElementById('total-winst').textContent = 
            `€ ${result.winst.toFixed(2)}`;
        document.getElementById('total-prijs').textContent = 
            `€ ${result.totaal.toFixed(2)}`;
        
        // === FACTUUROVERZICHT ===
        const invoiceItemsContainer = document.getElementById('invoice-items');
        invoiceItemsContainer.innerHTML = '';
        
        const componentNames = {
            'afkappen': 'Afkappen',
            'injecties': 'Injecties',
            'membraan': 'SNC-membraan',
            'bezetten': 'Bezetten',
            'xps': 'XPS isolatie',
            'wedi': 'Wedi Bouwplaten',
            'ultradun': 'Compacte dichting',
            'fixfinish': 'Fix & Finish',
            'fassashield': 'Fassa Shield',
            'grondering': 'Grondering Muur'
        };
        
        ['afkappen', 'injecties', 'membraan', 'bezetten', 'xps', 'wedi',
         'ultradun', 'fixfinish', 'fassashield', 'grondering'].forEach(comp => {
            if (qty[comp] > 0 && result[comp]) {
                const unit = (comp === 'injecties') ? 'm' : 'm²';
                const eenheidsprijs = result[comp].prijs;
                const subtotaal = result[comp].subtotaal;
                
                const row = document.createElement('div');
                row.className = 'invoice-row';
                row.innerHTML = `
                    <span class="component-name">${componentNames[comp]}</span>
                    <span class="component-calc">${qty[comp].toFixed(2)} ${unit} x 
                    EUR ${eenheidsprijs.toFixed(2)}</span>
                    <span class="component-total">€ ${subtotaal.toFixed(2)}</span>
                `;
                invoiceItemsContainer.appendChild(row);
            }
        });
        
        if (bijkomend_totaal > 0 && oppervlakte_bezetten > 0) {
            const eenheidsprijs = bijkomend_totaal / oppervlakte_bezetten;
            const row = document.createElement('div');
            row.className = 'invoice-row';
            row.innerHTML = `
                <span class="component-name">Bijkomend pleisterwerk</span>
                <span class="component-calc">${oppervlakte_bezetten.toFixed(2)} m² x 
                EUR ${eenheidsprijs.toFixed(2)}</span>
                <span class="component-total">€ ${bijkomend_totaal.toFixed(2)}</span>
            `;
            invoiceItemsContainer.appendChild(row);
        }
        
        if (egalisatie_totaal > 0 && oppervlakte_bezetten > 0) {
            const eenheidsprijs = egalisatie_totaal / oppervlakte_bezetten;
            const row = document.createElement('div');
            row.className = 'invoice-row';
            row.innerHTML = `
                <span class="component-name">Bijkomende egalisatie</span>
                <span class="component-calc">${oppervlakte_bezetten.toFixed(2)} m² x 
                EUR ${eenheidsprijs.toFixed(2)}</span>
                <span class="component-total">€ ${egalisatie_totaal.toFixed(2)}</span>
            `;
            invoiceItemsContainer.appendChild(row);
        }
        
        if (hoekprofielen_totaal > 0 && hoekprofielen_meters > 0) {
            const eenheidsprijs = hoekprofielen_totaal / hoekprofielen_meters;
            const row = document.createElement('div');
            row.className = 'invoice-row';
            row.innerHTML = `
                <span class="component-name">Hoekprofiel(en)</span>
                <span class="component-calc">${hoekprofielen_meters.toFixed(2)} m x 
                EUR ${eenheidsprijs.toFixed(2)}</span>
                <span class="component-total">€ ${hoekprofielen_totaal.toFixed(2)}</span>
            `;
            invoiceItemsContainer.appendChild(row);
        }
        
        document.getElementById('invoice-total').textContent = 
            `€ ${result.totaal.toFixed(2)}`;
        
        // Toggle dormant state voor invoice card (gelijk aan summary)
        document.getElementById('invoice').classList.toggle('dormant', !hasAnyValue);
    }

    // === EVENT LISTENERS ===
    const inputIds = [
        'afkappen', 'injecties', 'membraan', 'bezetten',
        'hoekprofielen', 'bijkomendpleister', 'egalisatie',
        'xps', 'wedi', 'ultradun', 'fixfinish', 'fassashield', 'grondering'  // V8.8: grondering toegevoegd
    ];
    
    inputIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            // Input event: calculate en update unit positie
            element.addEventListener('input', function(e) {
                calculate();
                UnitPositioner.update(e.target);
            });
            
            // Blur event: format naar 1 decimaal en update positie
            element.addEventListener('blur', function(e) {
                const value = parseFloat(e.target.value.replace(',', '.'));
                if (!isNaN(value) && value >= 0) {
                    e.target.value = value.toFixed(1).replace('.', ',');
                    UnitPositioner.update(e.target);
                } else if (e.target.value.trim() !== '') {
                    e.target.value = '';
                    UnitPositioner.update(e.target);
                }
                calculate();
            });
            
            // Focus event: selecteer waarde voor makkelijk overschrijven
            element.addEventListener('focus', function() {
                if (element.value) {
                    element.select();
                }
            });
        }
    });
    
    ['xps-dikte', 'ultradun-systeem', 'sopro-lagen', 'wedi-dikte', 'wedi-gitex', 'product-grondering'].forEach(id => {
        const select = document.getElementById(id);
        select.addEventListener('change', function(e) {
            // Toggle placeholder-active class
            if (e.target.value === '' || e.target.selectedOptions[0].disabled) {
                e.target.classList.add('placeholder-active');
            } else {
                e.target.classList.remove('placeholder-active');
                UnitPositioner.update(e.target);
            }
            
            // V9.1: Show/hide sopro-lagen and asocret-autex based on systeem selection
            if (id === 'ultradun-systeem') {
                const lagenWrapper = document.getElementById('sopro-lagen-wrapper');
                const lagenSelect = document.getElementById('sopro-lagen');
                const autexWrapper = document.getElementById('asocret-autex-wrapper');
                
                if (e.target.value === 'sopro') {
                    lagenWrapper.style.display = 'block';
                    autexWrapper.style.display = 'none';
                } else if (e.target.value === 'asocret') {
                    lagenWrapper.style.display = 'none';
                    lagenSelect.value = '2';
                    autexWrapper.style.display = 'block';
                } else {
                    // Sulfatex or no selection
                    lagenWrapper.style.display = 'none';
                    lagenSelect.value = '2';
                    autexWrapper.style.display = 'none';
                }
            }
            
            calculate();
        });
    });

    // V9.1: Autex checkbox event listener
    document.getElementById('asocret-autex').addEventListener('change', calculate);

    // Initialize UnitPositioner
    UnitPositioner.init();

    // Initial calculate
    calculate();
    </script>
</body>
</html>
